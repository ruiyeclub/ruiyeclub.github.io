<!DOCTYPE html>




<html class="theme-next tumo" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.1">








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/tumo.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Ray4j's Blog" />










<meta name="description" content="Awesome guy.">
<meta property="og:type" content="website">
<meta property="og:title" content="Ruiyeclub">
<meta property="og:url" content="https://ruiyeclub.cn/page/2/index.html">
<meta property="og:site_name" content="Ruiyeclub">
<meta property="og:description" content="Awesome guy.">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Cr.">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Tumo',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://ruiyeclub.cn/page/2/"/>





  <title>Ruiyeclub</title>
  








<meta name="generator" content="Hexo 7.1.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" style="overflow-x:hidden;padding-right:320px" lang="en">

  <style>@media (min-width:768px) and (max-width:991px){body .header-innerr{width:700px!important}}.header-innerr{margin:0 auto;padding:100px 0 70px;width:880px}@media (min-width:1600px){.container .header-innerr{width:1200px}}.header-innerr{position:relative}.header-innerr{padding:20px 0 0}.header-innerr:after,.header-innerr:before{content:" ";display:table}.header-innerr:after{clear:both}@media (max-width:767px){.header-innerr{width:auto;padding:10px;margin-bottom:-20px}}</style>

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    
    

    <link href="/lib/font-awesome/css/font-merienda.css?v=4.6.2" rel="stylesheet" type="text/css" />

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title" style="font-family:Merienda;font-size:1.3rem">Ruiyeclub</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">

  
    <ul id="menu" class="menu">
      
        
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            HOME
          </a>
        </li>
      
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            ARCHIVES
          </a>
        </li>
      
        
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            ABOUT
          </a>
        </li>
      
        
        
        <li class="menu-item menu-item-links">
          <a href="/links/" rel="section">
            LINKS
          </a>
        </li>
      

    </ul>
  

</nav>



 </div>

      <div class="header-innerr">
        
          <div class="note info" style="margin:0;letter-spacing:.15px">
            ğŸ¤SpringBootå­¦ä¹ å…¥é—¨Demoï¼ŒæŒç»­æ›´æ–°ä¸­...ï¼š
            <a style="color:#40dab2;font-weight:600" 
              href="https://github.com/ruiyeclub/SpringBoot-Hello" target="_blank" class="animsition-link">
              https://github.com/ruiyeclub/SpringBoot-Hello
            </a>
          </div>
        
      </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  
  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://ruiyeclub.cn/2022/07/27/Idea%E5%BC%80%E5%8F%91%E5%BF%85%E8%A3%85%E6%8F%92%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruiyeclub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/07/27/Idea%E5%BC%80%E5%8F%91%E5%BF%85%E8%A3%85%E6%8F%92%E4%BB%B6/" itemprop="url">Ideaå¼€å‘å¿…è£…æ’ä»¶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-07-27T15:24:24+08:00">
                2022-07-27
              </time>
            
          </span>

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>ï¼‚å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼‚ï¼Œåˆ†äº«ä¸€ä¸‹æˆ‘å·¥ä½œä¸­å¿…å¤‡çš„Ideaå¼€å‘æ’ä»¶</p>
</blockquote>
<h3 id="1-Alibaba-Java-Coding-Guidelines"><a href="#1-Alibaba-Java-Coding-Guidelines" class="headerlink" title="1.Alibaba Java Coding Guidelines"></a>1.Alibaba Java Coding Guidelines</h3><blockquote>
<p>æˆ‘ä»¬å¾ˆé«˜å…´æ¨å‡ºé˜¿é‡Œå·´å·´ Java ç¼–ç æŒ‡å—ï¼Œå®ƒæ•´åˆäº†é˜¿é‡Œå·´å·´é›†å›¢æŠ€æœ¯å›¢é˜Ÿå¤šå¹´æ¥çš„æœ€ä½³ç¼–ç¨‹å®è·µã€‚å¤§é‡çš„ Java ç¼–ç¨‹å›¢é˜Ÿå¯¹è·¨é¡¹ç›®çš„ä»£ç è´¨é‡æå‡ºäº†è‹›åˆ»çš„è¦æ±‚ï¼Œå› ä¸ºæˆ‘ä»¬é¼“åŠ±é‡ç”¨å’Œæ›´å¥½åœ°ç†è§£å½¼æ­¤çš„ç¨‹åºã€‚è¿‡å»æˆ‘ä»¬è§è¿‡å¾ˆå¤šç¼–ç¨‹é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæœ‰ç¼ºé™·çš„æ•°æ®åº“è¡¨ç»“æ„å’Œç´¢å¼•è®¾è®¡å¯èƒ½ä¼šå¯¼è‡´è½¯ä»¶æ¶æ„ç¼ºé™·å’Œæ€§èƒ½é£é™©ã€‚å¦ä¸€ä¸ªä¾‹å­æ˜¯éš¾ä»¥ç»´æŠ¤çš„æ··ä¹±ä»£ç ç»“æ„ã€‚æ­¤å¤–ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ˜“å—æ”»å‡»çš„ä»£ç å¾ˆå®¹æ˜“å—åˆ°é»‘å®¢çš„æ”»å‡»ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬ä¸ºé˜¿é‡Œå·´å·´çš„ Java å¼€å‘äººå‘˜ç¼–å†™äº†è¿™ä»½æ–‡æ¡£ã€‚</p>
</blockquote>
<p>é˜¿é‡Œå·´å·´ä»£ç è§„èŒƒæ£€æŸ¥æ’ä»¶ï¼Œæœ‰åŠ©äºæˆ‘ä»¬çš„ä»£ç æ›´åŠ è§„èŒƒã€‚</p>
<h3 id="2-ignore"><a href="#2-ignore" class="headerlink" title="2.ignore"></a>2.ignore</h3><p>å¿½ç•¥Gitä¸å¿…è¦æäº¤çš„æ–‡ä»¶</p>
<h3 id="3-Codota-Ai"><a href="#3-Codota-Ai" class="headerlink" title="3.Codota Ai"></a>3.Codota Ai</h3><p>é€‚ç”¨äºJavaå’ŒJavaScriptçš„Codota AIè‡ªåŠ¨è¡¥å…¨ä»£ç æ’ä»¶</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.codota.com/">Codota</a>åŸºäºæ•°ç™¾ä¸‡ä¸ªå¼€æº Java ç¨‹åºå’Œæ‚¨çš„ä¸Šä¸‹æ–‡å®Œæˆä»£ç è¡Œï¼Œå¸®åŠ©æ‚¨æ›´å¿«åœ°ç¼–å†™ä»£ç å¹¶å‡å°‘é”™è¯¯ã€‚æ–°ç‰ˆ Codota æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
</blockquote>
<ul>
<li>å…¨çº¿AIè‡ªåŠ¨å®Œæˆ</li>
<li>è¡Œå†…å’Œç›¸å…³çš„ä»£ç ç¤ºä¾‹</li>
<li>åŸºäºæ‚¨è‡ªå·±çš„ç¼–ç å®è·µçš„ä»£ç å»ºè®®</li>
</ul>
<h3 id="4-Easy-Code"><a href="#4-Easy-Code" class="headerlink" title="4.Easy Code"></a>4.Easy Code</h3><blockquote>
<p>EasyCodeæ˜¯åŸºäºIntelliJ IDEA Ultimateç‰ˆå¼€å‘çš„ä¸€ä¸ªä»£ç ç”Ÿæˆæ’ä»¶ï¼Œä¸»è¦é€šè¿‡è‡ªå®šä¹‰æ¨¡æ¿ï¼ˆåŸºäºvelocityï¼‰æ¥ç”Ÿæˆå„ç§ä½ æƒ³è¦çš„ä»£ç ã€‚é€šå¸¸ç”¨äºç”ŸæˆEntityã€Daoã€Serviceã€Controllerã€‚å¦‚æœä½ åŠ¨æ‰‹èƒ½åŠ›å¼ºè¿˜å¯ä»¥ç”¨äºç”ŸæˆHTMLã€JSã€PHPç­‰ä»£ç ã€‚ç†è®ºä¸Šæ¥è¯´åªè¦æ˜¯ä¸æ•°æ®æœ‰å…³çš„ä»£ç éƒ½æ˜¯å¯ä»¥ç”Ÿæˆçš„ã€‚</p>
</blockquote>
<h3 id="5-JavaDoc"><a href="#5-JavaDoc" class="headerlink" title="5.JavaDoc"></a>5.JavaDoc</h3><p>å¿«é€Ÿç”Ÿæˆjavadocæ–‡æ¡£æ³¨é‡Š</p>
<h3 id="6-Lombok"><a href="#6-Lombok" class="headerlink" title="6.Lombok"></a>6.Lombok</h3><p>ä¸»è¦ç”¨é€”æ˜¯æä¾›äº†ç®€å•çš„æ³¨è§£çš„å½¢å¼æ¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–æ¶ˆé™¤ä¸€äº›å¿…é¡»æœ‰ä½†æ˜¾å¾—å¾ˆè‡ƒè‚¿çš„ java ä»£ç ï¼Œæé«˜ç¼–ç æ•ˆç‡ï¼Œä½¿ä»£ç æ›´ç®€æ´ã€‚</p>
<h3 id="7-MyBatisPlus"><a href="#7-MyBatisPlus" class="headerlink" title="7.MyBatisPlus"></a>7.MyBatisPlus</h3><blockquote>
<p>generator code<br>live template<br>MybatisPlus plugin from java to xml or from xml to java</p>
</blockquote>
<h3 id="8-Nyan-Progress-Bar"><a href="#8-Nyan-Progress-Bar" class="headerlink" title="8.Nyan Progress Bar"></a>8.Nyan Progress Bar</h3><blockquote>
<p>Pretty progress bars with nyan cat for IJ based IDEs.</p>
</blockquote>
<p><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/picgo/image-20220727142237704.png" alt="Nyan Progress Bar"></p>
<h3 id="9-One-Dark-theme"><a href="#9-One-Dark-theme" class="headerlink" title="9.One Dark theme"></a>9.One Dark theme</h3><p>å…¶ä¸­One Dark Vividä¸»é¢˜çœŸçš„å¾ˆç®€æ´ã€èˆ’æœï¼Œçœ‹è…»äº†Ideaè‡ªå¸¦çš„ç³»ç»Ÿï¼Œå¯ä»¥è€ƒè™‘æ¢ä¸ªä¸»é¢˜è¯•è¯•ã€‚</p>
<p><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/picgo/image-20220727143552405.png" alt="One Dark Vivid"></p>
<h3 id="10-Translation"><a href="#10-Translation" class="headerlink" title="10.Translation"></a>10.Translation</h3><blockquote>
<p>Translation plugin for IntelliJ based IDEs&#x2F;Android Studio&#x2F;HUAWEI DevEco Studio.</p>
</blockquote>
<p><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/picgo/68747470733a2f2f63646e2e6a7364656c6976722e6e65742f67682f596969477578696e672f5472616e736c6174696f6e506c7567696e406d61737465722f696d616765732f73637265656e73686f74732e676966.gif" alt="translation"></p>
<h3 id="11-å…¶ä»–"><a href="#11-å…¶ä»–" class="headerlink" title="11.å…¶ä»–"></a>11.å…¶ä»–</h3><p>Pythonã€requirementsç­‰å¼€å‘pythonçš„æ’ä»¶ï¼Œè®©æˆ‘å¯ä»¥æ›´æ–¹ä¾¿çš„åœ¨Ideaä¸­ç¼–å†™pythonä»£ç ã€‚</p>

          
        
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>

  <hr/>

    
      

  

  
  
  
  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://ruiyeclub.cn/2022/06/01/SpringBoot-Vue%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E6%95%99%E7%A8%8B(%E8%BD%AC)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruiyeclub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/06/01/SpringBoot-Vue%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E6%95%99%E7%A8%8B(%E8%BD%AC)/" itemprop="url">SpringBoot+Vueå‰åç«¯åˆ†ç¦»é¡¹ç›®éƒ¨ç½²æ•™ç¨‹(è½¬)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-01T09:39:56+08:00">
                2022-06-01
              </time>
            
          </span>

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-æ‰“åŒ…åç«¯é¡¹ç›®jaråŒ…"><a href="#1-æ‰“åŒ…åç«¯é¡¹ç›®jaråŒ…" class="headerlink" title="1.æ‰“åŒ…åç«¯é¡¹ç›®jaråŒ…"></a>1.æ‰“åŒ…åç«¯é¡¹ç›®jaråŒ…</h2><p>æ‰“å¼€pom.xmlæ–‡ä»¶ï¼Œä¿®æ”¹packagingæ–¹å¼ä¸ºjar<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/1b2cb327efd7ff924aed08f1b823c4a4.png" alt="image.png"></p>
<p>ç‚¹å‡»å³ä¾§mavenæ’ä»¶ -&gt; package<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/13824b79027f796b472c606e9fd34358.png" alt="image.png"></p>
<p>æ‰“åŒ…æˆåŠŸåä¼šåœ¨targetç›®å½•ä¸‹ç”ŸæˆjaråŒ…<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/56a039e0a216ddb1119aea33946b87e0.png" alt="image.png"></p>
<h2 id="2-ç¼–å†™Dockerfileæ–‡ä»¶"><a href="#2-ç¼–å†™Dockerfileæ–‡ä»¶" class="headerlink" title="2.ç¼–å†™Dockerfileæ–‡ä»¶"></a>2.ç¼–å†™Dockerfileæ–‡ä»¶</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FROM java:8</span><br><span class="line">VOLUME /tmp</span><br><span class="line">ADD blog-springboot-0.0.1.jar blog.jar       </span><br><span class="line">ENTRYPOINT [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/blog.jar&quot;</span>] </span><br><span class="line">sh</span><br><span class="line">FROM java:8</span><br><span class="line">VOLUME /tmp</span><br><span class="line">ADD blog-springboot-0.0.1.jar blog.jar       </span><br><span class="line">ENTRYPOINT [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/blog.jar&quot;</span>] </span><br></pre></td></tr></table></figure>
<p>psï¼šDockerfileæ–‡ä»¶ä¸éœ€è¦åç¼€ï¼Œç›´æ¥ä¸ºæ–‡ä»¶æ ¼å¼</p>
<h2 id="3-ç¼–å†™blog-start-shè„šæœ¬"><a href="#3-ç¼–å†™blog-start-shè„šæœ¬" class="headerlink" title="3.ç¼–å†™blog-start.shè„šæœ¬"></a>3.ç¼–å†™blog-start.shè„šæœ¬</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æºjarè·¯å¾„  </span></span><br><span class="line">SOURCE_PATH=/usr/local/docker</span><br><span class="line"><span class="comment">#docker é•œåƒ/å®¹å™¨åå­—æˆ–è€…jaråå­— è¿™é‡Œéƒ½å‘½åä¸ºè¿™ä¸ª</span></span><br><span class="line">SERVER_NAME=blog-springboot-0.0.1.jar</span><br><span class="line">TAG=latest</span><br><span class="line">SERVER_PORT=8080</span><br><span class="line"><span class="comment">#å®¹å™¨id</span></span><br><span class="line">CID=$(docker ps | grep <span class="string">&quot;<span class="variable">$SERVER_NAME</span>&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"><span class="comment">#é•œåƒid</span></span><br><span class="line">IID=$(docker images | grep <span class="string">&quot;<span class="variable">$SERVER_NAME</span>:<span class="variable">$TAG</span>&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$CID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;å­˜åœ¨å®¹å™¨<span class="variable">$SERVER_NAME</span>, CID-<span class="variable">$CID</span>&quot;</span></span><br><span class="line">  docker stop <span class="variable">$SERVER_NAME</span></span><br><span class="line">  docker <span class="built_in">rm</span> <span class="variable">$SERVER_NAME</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># æ„å»ºdockeré•œåƒ</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$IID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;å­˜åœ¨<span class="variable">$SERVER_NAME</span>:<span class="variable">$TAG</span>é•œåƒï¼ŒIID=<span class="variable">$IID</span>&quot;</span></span><br><span class="line">  docker rmi <span class="variable">$SERVER_NAME</span>:<span class="variable">$TAG</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;ä¸å­˜åœ¨<span class="variable">$SERVER_NAME</span>:<span class="variable">$TAG</span>é•œåƒï¼Œå¼€å§‹æ„å»ºé•œåƒ&quot;</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$SOURCE_PATH</span></span><br><span class="line">  docker build -t <span class="variable">$SERVER_NAME</span>:<span class="variable">$TAG</span> .</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># è¿è¡Œdockerå®¹å™¨</span></span><br><span class="line">docker run --name <span class="variable">$SERVER_NAME</span> -v /usr/local/upload:/usr/local/upload -d -p <span class="variable">$SERVER_PORT</span>:<span class="variable">$SERVER_PORT</span> <span class="variable">$SERVER_NAME</span>:<span class="variable">$TAG</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$SERVER_NAME</span>å®¹å™¨åˆ›å»ºå®Œæˆ&quot;</span></span><br><span class="line">sh</span><br><span class="line"><span class="comment">#æºjarè·¯å¾„  </span></span><br><span class="line">SOURCE_PATH=/usr/local/docker</span><br><span class="line"><span class="comment">#docker é•œåƒ/å®¹å™¨åå­—æˆ–è€…jaråå­— è¿™é‡Œéƒ½å‘½åä¸ºè¿™ä¸ª</span></span><br><span class="line">SERVER_NAME=blog-springboot-0.0.1.jar</span><br><span class="line">TAG=latest</span><br><span class="line">SERVER_PORT=8080</span><br><span class="line"><span class="comment">#å®¹å™¨id</span></span><br><span class="line">CID=$(docker ps | grep <span class="string">&quot;<span class="variable">$SERVER_NAME</span>&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"><span class="comment">#é•œåƒid</span></span><br><span class="line">IID=$(docker images | grep <span class="string">&quot;<span class="variable">$SERVER_NAME</span>:<span class="variable">$TAG</span>&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$CID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;å­˜åœ¨å®¹å™¨<span class="variable">$SERVER_NAME</span>, CID-<span class="variable">$CID</span>&quot;</span></span><br><span class="line">  docker stop <span class="variable">$SERVER_NAME</span></span><br><span class="line">  docker <span class="built_in">rm</span> <span class="variable">$SERVER_NAME</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># æ„å»ºdockeré•œåƒ</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$IID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;å­˜åœ¨<span class="variable">$SERVER_NAME</span>:<span class="variable">$TAG</span>é•œåƒï¼ŒIID=<span class="variable">$IID</span>&quot;</span></span><br><span class="line">  docker rmi <span class="variable">$SERVER_NAME</span>:<span class="variable">$TAG</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;ä¸å­˜åœ¨<span class="variable">$SERVER_NAME</span>:<span class="variable">$TAG</span>é•œåƒï¼Œå¼€å§‹æ„å»ºé•œåƒ&quot;</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$SOURCE_PATH</span></span><br><span class="line">  docker build -t <span class="variable">$SERVER_NAME</span>:<span class="variable">$TAG</span> .</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># è¿è¡Œdockerå®¹å™¨</span></span><br><span class="line">docker run --name <span class="variable">$SERVER_NAME</span> -v /usr/local/upload:/usr/local/upload -d -p <span class="variable">$SERVER_PORT</span>:<span class="variable">$SERVER_PORT</span> <span class="variable">$SERVER_NAME</span>:<span class="variable">$TAG</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$SERVER_NAME</span>å®¹å™¨åˆ›å»ºå®Œæˆ&quot;</span></span><br></pre></td></tr></table></figure>
<p>psï¼šshæ–‡ä»¶éœ€è¦ç”¨notepad++è½¬ä¸ºUnixæ ¼å¼<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/aaed807d8df80aae11a94ea00df2264c.png" alt="image.png"></p>
<h2 id="4-å°†æ–‡ä»¶ä¼ è¾“åˆ°æœåŠ¡å™¨"><a href="#4-å°†æ–‡ä»¶ä¼ è¾“åˆ°æœåŠ¡å™¨" class="headerlink" title="4.å°†æ–‡ä»¶ä¼ è¾“åˆ°æœåŠ¡å™¨"></a>4.å°†æ–‡ä»¶ä¼ è¾“åˆ°æœåŠ¡å™¨</h2><p><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/183030180db2eb36f8949a2c81cb02ea.png" alt="image.png"></p>
<p>å°†ä¸Šè¿°ä¸‰ä¸ªæ–‡ä»¶ä¼ è¾“åˆ°&#x2F;usr&#x2F;local&#x2F;dockerä¸‹ï¼ˆæ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶å¤¹ï¼‰<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/d84ab03c0e7b56ee01dce5f89d30d554.png" alt="image.png"></p>
<h2 id="5-dockerè¿è¡Œåç«¯é¡¹ç›®"><a href="#5-dockerè¿è¡Œåç«¯é¡¹ç›®" class="headerlink" title="5.dockerè¿è¡Œåç«¯é¡¹ç›®"></a>5.dockerè¿è¡Œåç«¯é¡¹ç›®</h2><p>è¿›å…¥æœåŠ¡å™¨&#x2F;usr&#x2F;local&#x2F;dockerä¸‹ï¼Œæ„å»ºåç«¯é•œåƒ</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh ./blog-start.sh </span><br></pre></td></tr></table></figure>

<p><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/9a59bf2c7c8c465b707e5645a4b175b1.png" alt="image.png"><br>psï¼šç¬¬ä¸€æ¬¡æ—¶é—´å¯èƒ½æ¯”è¾ƒé•¿ï¼Œè€å¿ƒç­‰å¾…å³å¯</p>
<p>æŸ¥çœ‹æ˜¯å¦æ„å»ºæˆåŠŸ<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/1096233de4147cd81b65728a495914a7.png" alt="image.png"></p>
<p>å¯ä»¥å»æµ‹è¯•ä¸‹æ¥å£æ˜¯å¦è¿è¡ŒæˆåŠŸ<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/a91b807200f73c0c406eae9ffb1e4297.png" alt="image.png"><br>psï¼šéœ€è¦é‡æ–°éƒ¨ç½²åªéœ€é‡æ–°ä¼ jaråŒ…ï¼Œæ‰§è¡Œshè„šæœ¬å³å¯</p>
<h2 id="6-æ‰“åŒ…å‰ç«¯é¡¹ç›®"><a href="#6-æ‰“åŒ…å‰ç«¯é¡¹ç›®" class="headerlink" title="6.æ‰“åŒ…å‰ç«¯é¡¹ç›®"></a>6.æ‰“åŒ…å‰ç«¯é¡¹ç›®</h2><p>æ‰“å¼€cmdï¼Œè¿›å…¥Vueé¡¹ç›®è·¯å¾„ -&gt; npm run build<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/718358e5cc8e32b6ed1b0e0788dd7e22.png" alt="image.png"></p>
<p>æ‰“åŒ…æˆåŠŸåä¼šåœ¨ç›®å½•ä¸‹ç”Ÿæˆdistæ–‡ä»¶<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/0b0b7a9a815eeef02e658c15ea0b564b.png" alt="image.png"></p>
<p>å°†Vueæ‰“åŒ…é¡¹ç›®ä¼ è¾“åˆ°&#x2F;usr&#x2F;local&#x2F;vueä¸‹ï¼ˆç”±äºæˆ‘å‰å°å’Œåå°åˆ†ä¸ºä¸¤ä¸ªé¡¹ç›®ï¼Œæ‰€ä»¥æ”¹ådistæ–‡ä»¶ï¼‰<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/d8eb85b7f7bd34b93b1d2ac9b24142fb.png" alt="image.png"></p>
<h2 id="7-nginxé…ç½®-æœ‰åŸŸåé€‰è¿™ä¸ª"><a href="#7-nginxé…ç½®-æœ‰åŸŸåé€‰è¿™ä¸ª" class="headerlink" title="7.nginxé…ç½®(æœ‰åŸŸåé€‰è¿™ä¸ª)"></a>7.nginxé…ç½®(æœ‰åŸŸåé€‰è¿™ä¸ª)</h2><p>åœ¨&#x2F;usr&#x2F;local&#x2F;nginxä¸‹åˆ›å»ºnginx.confæ–‡ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    client_max_body_size     50m;</span><br><span class="line">    client_body_buffer_size  10m; </span><br><span class="line">    client_header_timeout    1m;</span><br><span class="line">    client_body_timeout      1m;</span><br><span class="line"></span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length  1k;</span><br><span class="line">    gzip_buffers     4 16k;</span><br><span class="line">    gzip_comp_level  4;</span><br><span class="line">    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;</span><br><span class="line">    gzip_vary on;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  å‰å°åŸŸå;</span><br><span class="line">     </span><br><span class="line">        location / &#123;		</span><br><span class="line">            root   /usr/local/vue/blog;</span><br><span class="line">            index  index.html index.htm; </span><br><span class="line">            try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;	</span><br><span class="line">        &#125;</span><br><span class="line">			</span><br><span class="line">	location ^~ /api/ &#123;		</span><br><span class="line">            proxy_pass http://ä½ çš„ip:8080/;</span><br><span class="line">	    proxy_set_header   Host             <span class="variable">$host</span>;</span><br><span class="line">            proxy_set_header   X-Real-IP        <span class="variable">$remote_addr</span>;						</span><br><span class="line">            proxy_set_header   X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  åå°å­åŸŸå;</span><br><span class="line">     </span><br><span class="line">        location / &#123;		</span><br><span class="line">            root   /usr/local/vue/admin;</span><br><span class="line">            index  index.html index.htm; </span><br><span class="line">            try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;	</span><br><span class="line">        &#125;</span><br><span class="line">			</span><br><span class="line">	location ^~ /api/ &#123;		</span><br><span class="line">            proxy_pass http://ä½ çš„ip:8080/;</span><br><span class="line">	    proxy_set_header   Host             <span class="variable">$host</span>;</span><br><span class="line">            proxy_set_header   X-Real-IP        <span class="variable">$remote_addr</span>;						</span><br><span class="line">            proxy_set_header   X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  websocketå­åŸŸå;</span><br><span class="line">     </span><br><span class="line">        location / &#123;</span><br><span class="line">          proxy_pass http://ä½ çš„ip:8080/websocket;</span><br><span class="line">          proxy_http_version 1.1;</span><br><span class="line">          proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">          proxy_set_header Connection <span class="string">&quot;Upgrade&quot;</span>;</span><br><span class="line">          proxy_set_header Host <span class="variable">$host</span>:<span class="variable">$server_port</span>;</span><br><span class="line">          proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">          proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">          proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">       &#125;</span><br><span class="line">	</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  ä¸Šä¼ æ–‡ä»¶å­åŸŸå;</span><br><span class="line">     </span><br><span class="line">        location / &#123;		</span><br><span class="line">          <span class="built_in">alias</span> /usr/local/upload/; </span><br><span class="line">          autoindex on;</span><br><span class="line">          autoindex_exact_size on;</span><br><span class="line">          autoindex_localtime on;</span><br><span class="line">        &#125;		</span><br><span class="line">		</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>psï¼šæˆ‘å‰å°å’Œåå°æ—¶åˆ†ä¸ºä¸¤ä¸ªåŸŸåï¼Œæ‰€ä»¥å†™äº†ä¸¤ä¸ªserverï¼Œå‰ç«¯é¡¹ç›®è·¯å¾„ä¸ºä¹‹å‰ä¼ è¾“çš„è·¯å¾„ï¼Œå…¶ä»–ä¸¤ä¸ªä¸ºæ–‡ä»¶ä¸Šä¼ åŸŸåå’Œwebsocketè½¬å‘åŸŸåã€‚</p>
<p>dockerå¯åŠ¨nginxæœåŠ¡</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name nginx --restart=always -p 80:80 -d -v /usr/local/nginx/nginx.conf:/etc/nginx/nginx.conf -v /usr/local/vue:/usr/local/vue -v /usr/local/upload:/usr/local/upload nginx </span><br></pre></td></tr></table></figure>

<h2 id="8-nginxé…ç½®-æ— åŸŸåé€‰è¿™ä¸ª"><a href="#8-nginxé…ç½®-æ— åŸŸåé€‰è¿™ä¸ª" class="headerlink" title="8.nginxé…ç½®(æ— åŸŸåé€‰è¿™ä¸ª)"></a>8.nginxé…ç½®(æ— åŸŸåé€‰è¿™ä¸ª)</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    client_max_body_size     50m;</span><br><span class="line">    client_body_buffer_size  10m; </span><br><span class="line">    client_header_timeout    1m;</span><br><span class="line">    client_body_timeout      1m;</span><br><span class="line"></span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length  1k;</span><br><span class="line">    gzip_buffers     4 16k;</span><br><span class="line">    gzip_comp_level  4;</span><br><span class="line">    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;</span><br><span class="line">    gzip_vary on;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  ä½ çš„ip;</span><br><span class="line">     </span><br><span class="line">        location / &#123;		</span><br><span class="line">            root   /usr/local/vue/blog;</span><br><span class="line">            index  index.html index.htm; </span><br><span class="line">            try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;	</span><br><span class="line">        &#125;</span><br><span class="line">			</span><br><span class="line">	location ^~ /api/ &#123;		</span><br><span class="line">            proxy_pass http://ä½ çš„ip:8080/;</span><br><span class="line">	    proxy_set_header   Host             <span class="variable">$host</span>;</span><br><span class="line">            proxy_set_header   X-Real-IP        <span class="variable">$remote_addr</span>;						</span><br><span class="line">            proxy_set_header   X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">server &#123;</span><br><span class="line">        listen       81;</span><br><span class="line">        server_name  ä½ çš„ip;</span><br><span class="line">     </span><br><span class="line">        location / &#123;		</span><br><span class="line">            root   /usr/local/vue/admin;</span><br><span class="line">            index  index.html index.htm; </span><br><span class="line">            try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;	</span><br><span class="line">        &#125;</span><br><span class="line">			</span><br><span class="line">	location ^~ /api/ &#123;		</span><br><span class="line">            proxy_pass http://ä½ çš„ip:8080/;</span><br><span class="line">	    proxy_set_header   Host             <span class="variable">$host</span>;</span><br><span class="line">            proxy_set_header   X-Real-IP        <span class="variable">$remote_addr</span>;						</span><br><span class="line">            proxy_set_header   X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       82;</span><br><span class="line">        server_name  ä½ çš„ip;</span><br><span class="line">     </span><br><span class="line">        location / &#123;</span><br><span class="line">          proxy_pass http://ä½ çš„ip:8080/websocket;</span><br><span class="line">          proxy_http_version 1.1;</span><br><span class="line">          proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">          proxy_set_header Connection <span class="string">&quot;Upgrade&quot;</span>;</span><br><span class="line">          proxy_set_header Host <span class="variable">$host</span>:<span class="variable">$server_port</span>;</span><br><span class="line">          proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">          proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">          proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">       &#125;</span><br><span class="line">	</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       83;</span><br><span class="line">        server_name  ä½ çš„ip;</span><br><span class="line">     </span><br><span class="line">        location / &#123;		</span><br><span class="line">          <span class="built_in">alias</span> /usr/local/upload/; </span><br><span class="line">          autoindex on;</span><br><span class="line">          autoindex_exact_size on;</span><br><span class="line">          autoindex_localtime on;</span><br><span class="line">        &#125;		</span><br><span class="line">		</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>dockerå¯åŠ¨nginxæœåŠ¡</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name nginx --restart=always -p 80:80 -p 81:81 -p 82:82 -p 83:83 -d -v /usr/local/nginx/nginx.conf:/etc/nginx/nginx.conf -v /usr/local/vue:/usr/local/vue -v /usr/local/upload:/usr/local/upload nginx </span><br></pre></td></tr></table></figure>
<p>psï¼šéœ€è¦é€šè¿‡ip + ç«¯å£å·è®¿é—®é¡¹ç›®</p>
<h2 id="9-è¿è¡Œæµ‹è¯•"><a href="#9-è¿è¡Œæµ‹è¯•" class="headerlink" title="9.è¿è¡Œæµ‹è¯•"></a>9.è¿è¡Œæµ‹è¯•</h2><p>å»æµè§ˆå™¨æµ‹è¯•ä¸‹æ˜¯å¦è¿è¡ŒæˆåŠŸ<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/66732d08619276eea4be2f8ab7f32551.png" alt="image.png"></p>
<h2 id="10-å…¶ä»–è®¾ç½®"><a href="#10-å…¶ä»–è®¾ç½®" class="headerlink" title="10.å…¶ä»–è®¾ç½®"></a>10.å…¶ä»–è®¾ç½®</h2><p>è¿›å…¥åå°ç®¡ç† -&gt; ç½‘ç«™ç®¡ç† -&gt; å…¶ä»–è®¾ç½®ï¼Œé…ç½®websocketåŸŸå<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/a97b2594f13b2928072728067ac68968.png" alt="image.png"></p>
<h2 id="11-æ€»ç»“"><a href="#11-æ€»ç»“" class="headerlink" title="11.æ€»ç»“"></a>11.æ€»ç»“</h2><p>æ•´ä¸ªå‰åç«¯åˆ†ç¦»çš„éƒ¨ç½²æ•™ç¨‹åˆ°è¿™é‡Œå°±ç»“æŸå•¦ï¼Œç¬¬ä¸€æ¬¡éƒ¨ç½²å¯èƒ½ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œä¸è¿‡åé¢å°±è½»è½¦ç†Ÿè·¯äº†ï¼Œæœ‰é—®é¢˜çš„å¯ä»¥ç§èŠé—®æˆ‘æˆ–è€…åœ¨è¯„è®ºåŒºç•™è¨€ã€‚</p>

          
        
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>

  <hr/>

    
      

  

  
  
  
  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://ruiyeclub.cn/2022/06/01/SpringCloud%E4%BD%BF%E7%94%A8Feign%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1%E8%B8%A9%E7%9A%84%E5%9D%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruiyeclub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/06/01/SpringCloud%E4%BD%BF%E7%94%A8Feign%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1%E8%B8%A9%E7%9A%84%E5%9D%91/" itemprop="url">SpringCloudä½¿ç”¨FeignæœåŠ¡é€šä¿¡è¸©çš„å‘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-01T09:39:35+08:00">
                2022-06-01
              </time>
            
          </span>

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ã€€ã€€<strong>fallbackç†”æ–­å™¨å®ç°äº†Feignå®¢æˆ·ç«¯çš„æ‰€æœ‰æ–¹æ³•ï¼Œå½“ç½‘ç»œä¸é€šæˆ–è€…è®¿é—®å¤±è´¥æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨fallbackæœåŠ¡é™çº§ç±»ä¸­çš„æ–¹æ³•ã€‚</strong></p>
<p>å¯åŠ¨é¡¹ç›®æ—¶æŠ¥é”™äº†ï¼Œå…·ä½“çš„æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.IllegalStateException: No fallback instance of type <span class="keyword">class</span> <span class="title class_">com</span>.xxx.xxx.feign.fallback.RemoteUserFallback found <span class="keyword">for</span> feign client xxx</span><br></pre></td></tr></table></figure>

<p>æŠ¥é”™å†…å®¹æ˜æ˜¾æ˜¯æ²¡æ‰¾åˆ°RemoteUserFallBackè¿™ä¸ªç±»</p>
<p>1ã€æ£€æŸ¥é…ç½®æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">feign:</span><br><span class="line">  hystrix:</span><br><span class="line">    enabled: true # å¼€å¯Feignçš„ç†”æ–­åŠŸèƒ½ é»˜è®¤æ˜¯å…³é—­çš„</span><br></pre></td></tr></table></figure>
<p>2ã€å¯åŠ¨ç±»ä¸Šéœ€è¦@EnableFeignClientsæ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(basePackages = &#123;&quot;com.xxx.åŒ…å&quot;&#125;)</span> <span class="comment">//å¼€å¯Feignå¹¶æ‰«æFeignå®¢æˆ·ç«¯</span></span><br></pre></td></tr></table></figure>

<p>3ã€Feignå®¢æˆ·ç«¯ç±»ä¸Šä½¿ç”¨@FeignClientï¼Œé€šè¿‡fallbackå±æ€§æ¥æŒ‡æ˜å¯¹åº”ç†”æ–­å™¨çš„ç±»å</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;æœåŠ¡å&quot;, fallback = RemoteUserFallback.class,)</span> <span class="comment">//å£°æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªFeignå®¢æˆ·ç«¯ï¼Œå¹¶æŒ‡å®šè¯·æ±‚çš„æœåŠ¡å</span></span><br></pre></td></tr></table></figure>
<p><strong>4ã€fallbackç†”æ–­å™¨ç±»ä¸Šéœ€è¦åŠ æ³¨è§£@Componentï¼Œç¡®ä¿å¯ä»¥è¢«springæ‰«æ</strong></p>
<p>æˆ‘æŠ¥é”™çš„åŸå› å°±æ˜¯å‡ºç°åœ¨ç¬¬å››æ­¥è¿™é‡Œï¼Œå°½ç®¡æˆ‘åŠ äº†@componentæ³¨è§£ã€‚SpringBootåœ¨å¯åŠ¨çš„æ—¶å€™ ä¼šæ‰«æmainç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…è¿›è¡ŒBeançš„å®ä¾‹åŒ–ï¼Œä½†æ˜¯fallbackç†”æ–­å™¨ç±»å¹¶ä¸åœ¨æˆ‘å¯åŠ¨ç±»çš„å­ç±»ä¸‹é¢ï¼Œæˆ‘è¿™é‡Œæ˜¯é€šè¿‡å¼•å…¥å…¶æ¨¡å—æ¥è°ƒç”¨è¿™é‡Œé¢çš„æ–¹æ³•ã€‚</p>
<p>æ‰€ä»¥æœ€åæˆ‘åœ¨å¯åŠ¨ç±»ä¸ŠåŠ äº†@ComponentScanæ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.xxx&quot;&#125;)</span></span><br></pre></td></tr></table></figure>
<p>OKï¼ŒæˆåŠŸå¯åŠ¨å¹¶è®¿é—®æˆåŠŸã€‚</p>

          
        
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>

  <hr/>

    
      

  

  
  
  
  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://ruiyeclub.cn/2022/06/01/SpringBoot%E6%95%B4%E5%90%88Mail%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6-%E5%8F%91%E9%80%81%E6%A8%A1%E6%9D%BF%E9%82%AE%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruiyeclub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/06/01/SpringBoot%E6%95%B4%E5%90%88Mail%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6-%E5%8F%91%E9%80%81%E6%A8%A1%E6%9D%BF%E9%82%AE%E4%BB%B6/" itemprop="url">SpringBootæ•´åˆMailå‘é€é‚®ä»¶&å‘é€æ¨¡æ¿é‚®ä»¶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-01T09:38:58+08:00">
                2022-06-01
              </time>
            
          </span>

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ã€€ã€€æ•´åˆmailå‘é€é‚®ä»¶ï¼Œå…¶å®å°±æ˜¯é€šè¿‡ä»£ç æ¥æ“ä½œå‘é€é‚®ä»¶çš„æ­¥éª¤ï¼Œç¼–è¾‘æ”¶ä»¶äººã€é‚®ä»¶å†…å®¹ã€é‚®ä»¶é™„ä»¶ç­‰ç­‰ã€‚é€šè¿‡é‚®ä»¶å¯ä»¥æ‹“å±•å‡ºçŸ­ä¿¡éªŒè¯ç ã€æ¶ˆæ¯é€šçŸ¥ç­‰ä¸šåŠ¡ã€‚</p>
<h1 id="ä¸€ã€pomæ–‡ä»¶å¼•å…¥ä¾èµ–"><a href="#ä¸€ã€pomæ–‡ä»¶å¼•å…¥ä¾èµ–" class="headerlink" title="ä¸€ã€pomæ–‡ä»¶å¼•å…¥ä¾èµ–"></a>ä¸€ã€pomæ–‡ä»¶å¼•å…¥ä¾èµ–</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--freemarkeræ¨¡æ¿å¼•æ“æ˜¯ä¸ºäº†åé¢å‘é€æ¨¡æ¿é‚®ä»¶ ä¸éœ€è¦çš„å¯ä»¥ä¸å¼•å…¥--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="äºŒã€application-ymlæ–‡ä»¶ä¸­é…ç½®"><a href="#äºŒã€application-ymlæ–‡ä»¶ä¸­é…ç½®" class="headerlink" title="äºŒã€application.ymlæ–‡ä»¶ä¸­é…ç½®"></a>äºŒã€application.ymlæ–‡ä»¶ä¸­é…ç½®</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  mail:</span><br><span class="line">    host: smtp.qq.xyz #è¿™é‡Œæ¢æˆè‡ªå·±çš„é‚®ç®±ç±»å‹ ä¾‹å¦‚qqé‚®ç®±å°±å†™smtp.qq.com</span><br><span class="line">    username: xx@qq.com #QQé‚®ç®±</span><br><span class="line">    password: xxxxxxxxxxx #é‚®ç®±å¯†ç æˆ–è€…æˆæƒç </span><br><span class="line">    protocol: smtp #å‘é€é‚®ä»¶åè®®</span><br><span class="line">    properties.mail.smtp.auth: true</span><br><span class="line">    properties.mail.smtp.port: 465 #ç«¯å£å·465æˆ–587</span><br><span class="line">    properties.mail.smtp.starttls.enable: true</span><br><span class="line">    properties.mail.smtp.starttls.required: true</span><br><span class="line">    properties.mail.smtp.ssl.enable: true #å¼€å¯SSL</span><br><span class="line">    default-encoding: utf-8</span><br><span class="line">freemarker:</span><br><span class="line">  cache: false # ç¼“å­˜é…ç½® å¼€å‘é˜¶æ®µåº”è¯¥é…ç½®ä¸ºfalse å› ä¸ºç»å¸¸ä¼šæ”¹</span><br><span class="line">  suffix: .html # æ¨¡ç‰ˆåç¼€å é»˜è®¤ä¸ºftl</span><br><span class="line">  charset: UTF-8 # æ–‡ä»¶ç¼–ç </span><br><span class="line">  template-loader-path: classpath:/templates/  # å­˜æ”¾æ¨¡æ¿çš„æ–‡ä»¶å¤¹ï¼Œä»¥resourceæ–‡ä»¶å¤¹ä¸ºç›¸å¯¹è·¯å¾„</span><br></pre></td></tr></table></figure>
<p>é‚®ç®±å¯†ç æš´éœ²åœ¨é…ç½®æ–‡ä»¶å¾ˆä¸å®‰å…¨ï¼Œä¸€èˆ¬éƒ½æ˜¯é‡‡å–æˆæƒç çš„å½¢å¼ã€‚ç‚¹å¼€é‚®ç®±ï¼Œç„¶ååœ¨è´¦æˆ·æ é‡Œé¢ç‚¹å‡»ç”Ÿæˆæˆæƒç ï¼š<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/c2d0d1f35a98ed2c68a4fdc2e120dbc6.png" alt="image.png"></p>
<h1 id="ä¸‰ã€ç¼–å†™MailUtilså·¥å…·ç±»"><a href="#ä¸‰ã€ç¼–å†™MailUtilså·¥å…·ç±»" class="headerlink" title="ä¸‰ã€ç¼–å†™MailUtilså·¥å…·ç±»"></a>ä¸‰ã€ç¼–å†™MailUtilså·¥å…·ç±»</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailUtils</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Springå®˜æ–¹æä¾›çš„é›†æˆé‚®ä»¶æœåŠ¡çš„å®ç°ç±»ï¼Œç›®å‰æ˜¯Javaåç«¯å‘é€é‚®ä»¶å’Œé›†æˆé‚®ä»¶æœåŠ¡çš„ä¸»æµå·¥å…·ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JavaMailSender mailSender;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»é…ç½®æ–‡ä»¶ä¸­æ³¨å…¥å‘ä»¶äººçš„å§“å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.mail.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String fromEmail;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FreeMarkerConfigurer freeMarkerConfigurer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€æ–‡æœ¬é‚®ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to      æ”¶ä»¶äºº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subject æ ‡é¢˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content æ­£æ–‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendSimpleMail</span><span class="params">(String to, String subject, String content)</span> &#123;</span><br><span class="line">        <span class="type">SimpleMailMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleMailMessage</span>();</span><br><span class="line">        <span class="comment">//å‘ä»¶äºº</span></span><br><span class="line">        message.setFrom(fromEmail);</span><br><span class="line">        message.setTo(to);</span><br><span class="line">        message.setSubject(subject);</span><br><span class="line">        message.setText(content);</span><br><span class="line">        mailSender.send(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€htmlé‚®ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendHtmlMail</span><span class="params">(String to, String subject, String content)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯MimeMessage</span></span><br><span class="line">            <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> mailSender.createMimeMessage();</span><br><span class="line">            <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message, <span class="literal">true</span>);</span><br><span class="line">            helper.setFrom(fromEmail);</span><br><span class="line">            helper.setTo(to);</span><br><span class="line">            helper.setSubject(subject);</span><br><span class="line">            <span class="comment">//ç¬¬äºŒä¸ªå‚æ•°ï¼šæ ¼å¼æ˜¯å¦ä¸ºhtml</span></span><br><span class="line">            helper.setText(content, <span class="literal">true</span>);</span><br><span class="line">            mailSender.send(message);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (MessagingException e)&#123;</span><br><span class="line">            log.error(<span class="string">&quot;å‘é€é‚®ä»¶æ—¶å‘ç”Ÿå¼‚å¸¸ï¼&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€æ¨¡æ¿é‚®ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subject</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> template</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendTemplateMail</span><span class="params">(String to, String subject, String template)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å¾—æ¨¡æ¿</span></span><br><span class="line">            <span class="type">Template</span> <span class="variable">template1</span> <span class="operator">=</span> freeMarkerConfigurer.getConfiguration().getTemplate(template);</span><br><span class="line">            <span class="comment">// ä½¿ç”¨Mapä½œä¸ºæ•°æ®æ¨¡å‹ï¼Œå®šä¹‰å±æ€§å’Œå€¼</span></span><br><span class="line">            Map&lt;String,Object&gt; model = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            model.put(<span class="string">&quot;myname&quot;</span>,<span class="string">&quot;Rayã€‚&quot;</span>);</span><br><span class="line">            <span class="comment">// ä¼ å…¥æ•°æ®æ¨¡å‹åˆ°æ¨¡æ¿ï¼Œæ›¿ä»£æ¨¡æ¿ä¸­çš„å ä½ç¬¦ï¼Œå¹¶å°†æ¨¡æ¿è½¬åŒ–ä¸ºhtmlå­—ç¬¦ä¸²</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">templateHtml</span> <span class="operator">=</span> FreeMarkerTemplateUtils.processTemplateIntoString(template1,model);</span><br><span class="line">            <span class="comment">// è¯¥æ–¹æ³•æœ¬è´¨ä¸Šè¿˜æ˜¯å‘é€htmlé‚®ä»¶ï¼Œè°ƒç”¨ä¹‹å‰å‘é€htmlé‚®ä»¶çš„æ–¹æ³•</span></span><br><span class="line">            <span class="built_in">this</span>.sendHtmlMail(to, subject, templateHtml);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (TemplateException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å‘é€é‚®ä»¶æ—¶å‘ç”Ÿå¼‚å¸¸ï¼&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å‘é€é‚®ä»¶æ—¶å‘ç”Ÿå¼‚å¸¸ï¼&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€å¸¦é™„ä»¶çš„é‚®ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subject</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendAttachmentsMail</span><span class="params">(String to, String subject, String content, String filePath)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> mailSender.createMimeMessage();</span><br><span class="line">            <span class="comment">//è¦å¸¦é™„ä»¶ç¬¬äºŒä¸ªå‚æ•°è®¾ä¸ºtrue</span></span><br><span class="line">            <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message, <span class="literal">true</span>);</span><br><span class="line">            helper.setFrom(fromEmail);</span><br><span class="line">            helper.setTo(to);</span><br><span class="line">            helper.setSubject(subject);</span><br><span class="line">            helper.setText(content, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">FileSystemResource</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileSystemResource</span>(<span class="keyword">new</span> <span class="title class_">File</span>(filePath));</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> filePath.substring(filePath.lastIndexOf(File.separator));</span><br><span class="line">            helper.addAttachment(fileName, file);</span><br><span class="line">            mailSender.send(message);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (MessagingException e)&#123;</span><br><span class="line">            log.error(<span class="string">&quot;å‘é€é‚®ä»¶æ—¶å‘ç”Ÿå¼‚å¸¸ï¼&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MailUtilså…¶å®å°±æ˜¯è¿›ä¸€æ­¥å°è£…Mailæä¾›çš„JavaMailSenderç±»ï¼Œæ ¹æ®ä¸šåŠ¡åœºæ™¯å¯ä»¥åœ¨å·¥å…·ç±»é‡Œé¢æ·»åŠ å¯¹åº”çš„æ–¹æ³•ï¼Œè¿™é‡Œæä¾›äº†å‘é€æ–‡æœ¬é‚®ä»¶ã€htmlé‚®ä»¶ã€æ¨¡æ¿é‚®ä»¶ã€é™„ä»¶é‚®ä»¶çš„æ–¹æ³•ã€‚</p>
<h1 id="å››ã€Controllerå±‚çš„å®ç°"><a href="#å››ã€Controllerå±‚çš„å®ç°" class="headerlink" title="å››ã€Controllerå±‚çš„å®ç°"></a>å››ã€Controllerå±‚çš„å®ç°</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;é‚®ä»¶ç®¡ç†&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/mail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MailUtils mailUtils;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€æ³¨å†ŒéªŒè¯ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> éªŒè¯ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;å‘é€æ³¨å†ŒéªŒè¯ç &quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">()</span>&#123;</span><br><span class="line">        mailUtils.sendSimpleMail(<span class="string">&quot;ruiyeclub@foxmail.com&quot;</span>,<span class="string">&quot;æ™®é€šæ–‡æœ¬é‚®ä»¶&quot;</span>,<span class="string">&quot;æ™®é€šæ–‡æœ¬é‚®ä»¶å†…å®¹&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€æ³¨å†ŒéªŒè¯ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> éªŒè¯ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;å‘é€æ³¨å†ŒéªŒè¯ç &quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sendHtml&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendTemplateMail</span><span class="params">()</span>&#123;</span><br><span class="line">        mailUtils.sendHtmlMail(<span class="string">&quot;ruiyeclub@foxmail.com&quot;</span>,<span class="string">&quot;ä¸€å°htmlæµ‹è¯•é‚®ä»¶&quot;</span>,</span><br><span class="line">                <span class="string">&quot;&lt;div style=\&quot;text-align: center;position: absolute;\&quot; &gt;\n&quot;</span></span><br><span class="line">                        +<span class="string">&quot;&lt;h3&gt;\&quot;ä¸€å°htmlæµ‹è¯•é‚®ä»¶\&quot;&lt;/h3&gt;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;div&gt;ä¸€å°htmlæµ‹è¯•é‚®ä»¶&lt;/div&gt;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;/div&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;å‘é€htmlæ¨¡æ¿é‚®ä»¶&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sendTemplate&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        mailUtils.sendTemplateMail(<span class="string">&quot;ruiyeclub@foxmail.com&quot;</span>, <span class="string">&quot;åŸºäºæ¨¡æ¿çš„htmlé‚®ä»¶&quot;</span>, <span class="string">&quot;hello.html&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;å‘é€å¸¦é™„ä»¶çš„é‚®ä»¶&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;sendAttachmentsMail&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendAttachmentsMail</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;D:\\projects\\springboot\\template.png&quot;</span>;</span><br><span class="line">        mailUtils.sendAttachmentsMail(<span class="string">&quot;xxxx@xx.com&quot;</span>, <span class="string">&quot;å¸¦é™„ä»¶çš„é‚®ä»¶&quot;</span>, <span class="string">&quot;é‚®ä»¶ä¸­æœ‰é™„ä»¶&quot;</span>, filePath);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œè¿™é‡Œä½¿ç”¨äº†swagger3ï¼Œè¯¦æƒ…å¯ä»¥æŸ¥çœ‹<a href="SpringBoot%E6%95%B4%E5%90%88Swagger3%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3">SpringBootæ•´åˆSwagger3ç”Ÿæˆæ¥å£æ–‡æ¡£</a>ã€‚</p>
<p>å‘é€æ¨¡æ¿é‚®ä»¶è¿™é‡Œï¼Œä¼šè¯»å–resourcesä¸‹é¢çš„templatesæ–‡ä»¶å¤¹ï¼Œæµ‹è¯•ä¸­è¯»å–çš„æ˜¯hello.htmlï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>freemarkerç®€å•ç¤ºä¾‹<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Freemarker<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>My name is $&#123;myname&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="äº”ã€æµ‹è¯•ç»“æœ"><a href="#äº”ã€æµ‹è¯•ç»“æœ" class="headerlink" title="äº”ã€æµ‹è¯•ç»“æœ"></a>äº”ã€æµ‹è¯•ç»“æœ</h1><p><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/ce977f2c1c55d0f5c49f0d863f0eda89.png" alt="image.png"><br>å¦‚æœéœ€è¦è¾¾åˆ°é€šè¿‡é‚®ä»¶å‘é€éªŒè¯ç çš„åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨redisã€‚åå°éšæœºç”ŸæˆéªŒè¯ç ï¼Œç„¶åæŠŠç”¨æˆ·çš„ä¸»é”®è®¾ä¸ºkeyï¼ŒéªŒè¯ç çš„å†…å®¹è®¾ä¸ºvalueï¼Œè¿˜å¯ä»¥è®¾ç½®ä¸ª60sè¿‡æœŸå­˜å‚¨ï¼Œå‘é€æˆåŠŸåï¼Œç”¨æˆ·ç™»å½•é€šè¿‡ä¸»é”®ä»redisæ‹¿åˆ°å¯¹åº”çš„éªŒè¯ç ï¼Œç„¶åå†è¿›è¡Œç™»å½•éªŒè¯å°±å¥½äº†ã€‚</p>
<blockquote>
<p>å‚è€ƒé“¾æ¥ï¼š[Spring Bootæ•´åˆé‚®ä»¶é…ç½®](Spring Bootæ•´åˆé‚®ä»¶é…ç½®)</p>
</blockquote>
<p>GitHubåœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/ruiyeclub/SpringBoot-Hello">https://github.com/ruiyeclub/SpringBoot-Hello</a></p>

          
        
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>

  <hr/>

    
      

  

  
  
  
  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://ruiyeclub.cn/2022/06/01/SpringBoot%E6%95%B4%E5%90%88Swagger3%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruiyeclub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/06/01/SpringBoot%E6%95%B4%E5%90%88Swagger3%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/" itemprop="url">SpringBootæ•´åˆSwagger3ç”Ÿæˆæ¥å£æ–‡æ¡£</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-01T09:38:35+08:00">
                2022-06-01
              </time>
            
          </span>

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ã€€ã€€å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ï¼Œæ¥å£æ–‡æ¡£çš„å­˜åœ¨ååˆ†é‡è¦ã€‚ä¸æ‰‹åŠ¨ç¼–å†™æ¥å£æ–‡æ¡£ä¸åŒï¼Œswaggeræ˜¯ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£çš„å·¥å…·ï¼Œåœ¨éœ€æ±‚ä¸æ–­å˜æ›´çš„å¼€å‘ç¯å¢ƒä¸‹ï¼Œæ‰‹åŠ¨ç¼–å†™æ–‡æ¡£çš„æ•ˆç‡å®åœ¨å¤ªä½ã€‚ä¸æ–°ç‰ˆçš„swagger3ç›¸æ¯”swagger2é…ç½®æ›´å°‘ï¼Œä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€‚</p>
<h1 id="ä¸€ã€pomæ–‡ä»¶ä¸­å¼•å…¥Swagger3ä¾èµ–"><a href="#ä¸€ã€pomæ–‡ä»¶ä¸­å¼•å…¥Swagger3ä¾èµ–" class="headerlink" title="ä¸€ã€pomæ–‡ä»¶ä¸­å¼•å…¥Swagger3ä¾èµ–"></a>ä¸€ã€pomæ–‡ä»¶ä¸­å¼•å…¥Swagger3ä¾èµ–</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;springfox-boot-starter&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;<span class="number">3.0</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h1 id="äºŒã€Applicationä¸Šé¢åŠ å…¥-EnableOpenApiæ³¨è§£"><a href="#äºŒã€Applicationä¸Šé¢åŠ å…¥-EnableOpenApiæ³¨è§£" class="headerlink" title="äºŒã€Applicationä¸Šé¢åŠ å…¥@EnableOpenApiæ³¨è§£"></a>äºŒã€Applicationä¸Šé¢åŠ å…¥@EnableOpenApiæ³¨è§£</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableOpenApi</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &#123;&quot;cn.ruiyeclub.dao&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Swagger3Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Swagger3Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€Swagger3Configçš„é…ç½®"><a href="#ä¸‰ã€Swagger3Configçš„é…ç½®" class="headerlink" title="ä¸‰ã€Swagger3Configçš„é…ç½®"></a>ä¸‰ã€Swagger3Configçš„é…ç½®</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Swagger3Config</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.OAS_30)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.withMethodAnnotation(ApiOperation.class))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;Swagger3æ¥å£æ–‡æ¡£&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;æ›´å¤šè¯·å’¨è¯¢æœåŠ¡å¼€å‘è€…Rayã€‚&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;Rayã€‚&quot;</span>, <span class="string">&quot;http://www.ruiyeclub.cn&quot;</span>, <span class="string">&quot;ruiyeclub@foxmail.com&quot;</span>))</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="å››ã€Swaggeræ³¨è§£çš„ä½¿ç”¨è¯´æ˜"><a href="#å››ã€Swaggeræ³¨è§£çš„ä½¿ç”¨è¯´æ˜" class="headerlink" title="å››ã€Swaggeræ³¨è§£çš„ä½¿ç”¨è¯´æ˜"></a>å››ã€Swaggeræ³¨è§£çš„ä½¿ç”¨è¯´æ˜</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api</span>ï¼šç”¨åœ¨è¯·æ±‚çš„ç±»ä¸Šï¼Œè¡¨ç¤ºå¯¹ç±»çš„è¯´æ˜</span><br><span class="line">    tags=<span class="string">&quot;è¯´æ˜è¯¥ç±»çš„ä½œç”¨ï¼Œå¯ä»¥åœ¨UIç•Œé¢ä¸Šçœ‹åˆ°çš„æ³¨è§£&quot;</span></span><br><span class="line">    value=<span class="string">&quot;è¯¥å‚æ•°æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œåœ¨UIç•Œé¢ä¸Šä¹Ÿçœ‹åˆ°ï¼Œæ‰€ä»¥ä¸éœ€è¦é…ç½®&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiOperation</span>ï¼šç”¨åœ¨è¯·æ±‚çš„æ–¹æ³•ä¸Šï¼Œè¯´æ˜æ–¹æ³•çš„ç”¨é€”ã€ä½œç”¨</span><br><span class="line">    value=<span class="string">&quot;è¯´æ˜æ–¹æ³•çš„ç”¨é€”ã€ä½œç”¨&quot;</span></span><br><span class="line">    notes=<span class="string">&quot;æ–¹æ³•çš„å¤‡æ³¨è¯´æ˜&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiImplicitParams</span>ï¼šç”¨åœ¨è¯·æ±‚çš„æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºä¸€ç»„å‚æ•°è¯´æ˜</span><br><span class="line">    <span class="meta">@ApiImplicitParam</span>ï¼šç”¨åœ¨<span class="meta">@ApiImplicitParams</span>æ³¨è§£ä¸­ï¼ŒæŒ‡å®šä¸€ä¸ªè¯·æ±‚å‚æ•°çš„å„ä¸ªæ–¹é¢</span><br><span class="line">        nameï¼šå‚æ•°å</span><br><span class="line">        valueï¼šå‚æ•°çš„æ±‰å­—è¯´æ˜ã€è§£é‡Š</span><br><span class="line">        requiredï¼šå‚æ•°æ˜¯å¦å¿…é¡»ä¼ </span><br><span class="line">        paramTypeï¼šå‚æ•°æ”¾åœ¨å“ªä¸ªåœ°æ–¹</span><br><span class="line">            Â· header --&gt; è¯·æ±‚å‚æ•°çš„è·å–ï¼š<span class="meta">@RequestHeader</span></span><br><span class="line">            Â· query --&gt; è¯·æ±‚å‚æ•°çš„è·å–ï¼š<span class="meta">@RequestParam</span></span><br><span class="line">            Â· pathï¼ˆç”¨äºrestfulæ¥å£ï¼‰--&gt; è¯·æ±‚å‚æ•°çš„è·å–ï¼š<span class="meta">@PathVariable</span></span><br><span class="line">            Â· bodyï¼ˆä¸å¸¸ç”¨ï¼‰</span><br><span class="line">            Â· formï¼ˆä¸å¸¸ç”¨ï¼‰    </span><br><span class="line">        dataTypeï¼šå‚æ•°ç±»å‹ï¼Œé»˜è®¤Stringï¼Œå…¶å®ƒå€¼dataType=<span class="string">&quot;Integer&quot;</span>       </span><br><span class="line">        defaultValueï¼šå‚æ•°çš„é»˜è®¤å€¼</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiResponses</span>ï¼šç”¨åœ¨è¯·æ±‚çš„æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºä¸€ç»„å“åº”</span><br><span class="line">    <span class="meta">@ApiResponse</span>ï¼šç”¨åœ¨<span class="meta">@ApiResponses</span>ä¸­ï¼Œä¸€èˆ¬ç”¨äºè¡¨è¾¾ä¸€ä¸ªé”™è¯¯çš„å“åº”ä¿¡æ¯</span><br><span class="line">        codeï¼šæ•°å­—ï¼Œä¾‹å¦‚<span class="number">400</span></span><br><span class="line">        messageï¼šä¿¡æ¯ï¼Œä¾‹å¦‚<span class="string">&quot;è¯·æ±‚å‚æ•°æ²¡å¡«å¥½&quot;</span></span><br><span class="line">        responseï¼šæŠ›å‡ºå¼‚å¸¸çš„ç±»</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiModel</span>ï¼šç”¨äºå“åº”ç±»ä¸Šï¼Œè¡¨ç¤ºä¸€ä¸ªè¿”å›å“åº”æ•°æ®çš„ä¿¡æ¯</span><br><span class="line">            ï¼ˆè¿™ç§ä¸€èˆ¬ç”¨åœ¨poståˆ›å»ºçš„æ—¶å€™ï¼Œä½¿ç”¨<span class="meta">@RequestBody</span>è¿™æ ·çš„åœºæ™¯ï¼Œ</span><br><span class="line">            è¯·æ±‚å‚æ•°æ— æ³•ä½¿ç”¨<span class="meta">@ApiImplicitParam</span>æ³¨è§£è¿›è¡Œæè¿°çš„æ—¶å€™ï¼‰</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>ï¼šç”¨åœ¨å±æ€§ä¸Šï¼Œæè¿°å“åº”ç±»çš„å±æ€§</span><br></pre></td></tr></table></figure>
<p>Controllerå±‚çš„é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;ç”¨æˆ·ä¿¡æ¯ç®¡ç†&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;userRecord&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRecordController</span> <span class="keyword">extends</span> <span class="title class_">ApiController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœåŠ¡å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserRecordService userRecordService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæŸ¥è¯¢æ‰€æœ‰æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page       åˆ†é¡µå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userRecord æŸ¥è¯¢å®ä½“</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰€æœ‰æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;åˆ†é¡µæŸ¥è¯¢æ‰€æœ‰æ•°æ®&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">selectAll</span><span class="params">(Page&lt;UserRecord&gt; page, UserRecord userRecord)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="built_in">this</span>.userRecordService.page(page, <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;(userRecord)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡ä¸»é”®æŸ¥è¯¢å•æ¡æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id ä¸»é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å•æ¡æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;é€šè¿‡ä¸»é”®æŸ¥è¯¢å•æ¡æ•°æ®&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">selectOne</span><span class="params">(<span class="meta">@PathVariable</span> Serializable id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="built_in">this</span>.userRecordService.getById(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userRecord å®ä½“å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ–°å¢ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ–°å¢æ•°æ®&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;insert&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">insert</span><span class="params">(<span class="meta">@RequestBody</span> UserRecord userRecord)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="built_in">this</span>.userRecordService.save(userRecord));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userRecord å®ä½“å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä¿®æ”¹ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ä¿®æ”¹æ•°æ®&quot;)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> UserRecord userRecord)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="built_in">this</span>.userRecordService.updateById(userRecord));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> idList ä¸»é”®ç»“åˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åˆ é™¤ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;åˆ é™¤æ•°æ®&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;delete&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;idList&quot;)</span> List&lt;Long&gt; idList)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="built_in">this</span>.userRecordService.removeByIds(idList));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="äº”ã€Swaggerç•Œé¢æ•ˆæœ"><a href="#äº”ã€Swaggerç•Œé¢æ•ˆæœ" class="headerlink" title="äº”ã€Swaggerç•Œé¢æ•ˆæœ"></a>äº”ã€Swaggerç•Œé¢æ•ˆæœ</h1><p><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/2954ce2fd4c4dca470dc4cafd38e2fc3.png" alt="image.png"></p>
<p> Swaggerçš„è®¿é—®è·¯å¾„ç”±port&#x2F;swagger-ui.htmlæ”¹æˆäº†port&#x2F;swagger-ui&#x2F; æˆ–port&#x2F;swagger-ui&#x2F;index.html</p>
<blockquote>
<p>GitHubåœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/ruiyeclub/SpringBoot-Hello">https://github.com/ruiyeclub/SpringBoot-Hello</a></p>
</blockquote>

          
        
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>

  <hr/>

    
      

  

  
  
  
  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://ruiyeclub.cn/2022/06/01/Shiro%E6%95%B4%E5%90%88Redis-%E4%BD%BF%E7%94%A8shiro-redis%E6%8F%92%E4%BB%B6%E8%B8%A9%E7%9A%84%E5%9D%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruiyeclub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/06/01/Shiro%E6%95%B4%E5%90%88Redis-%E4%BD%BF%E7%94%A8shiro-redis%E6%8F%92%E4%BB%B6%E8%B8%A9%E7%9A%84%E5%9D%91/" itemprop="url">Shiroæ•´åˆRedis:ä½¿ç”¨shiro-redisæ’ä»¶è¸©çš„å‘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-01T09:36:13+08:00">
                2022-06-01
              </time>
            
          </span>

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ã€€ã€€ä¸€ç›´æƒ³åœ¨shiroæƒé™è¿™å—åŠ å…¥ç¼“å­˜ï¼Œä½¿ç”¨redisæ˜¯å†åˆé€‚ä¸è¿‡äº†ï¼Œæ°å·§å·²ç»æœ‰å¤§ä½¬å°†shiroå’Œredisæ•´åˆåœ¨ä¸€èµ·ä½¿ç”¨äº†ï¼Œåªéœ€åœ¨å¼•å…¥pomæ–‡ä»¶ä¸­å¼•å…¥å³å¯ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.crazycake<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯æ˜¯ä½¿ç”¨çš„æ—¶å€™ï¼Œæƒé™é…ç½®è¿™å—ï¼Œä¹Ÿå°±æ˜¯é‡å†™shiroçš„doGetAuthorizationInfoæ–¹æ³•è¿™é‡Œï¼Œä¸€ç›´è¿›ä¸æ¥ï¼Œå®Œæ•´çš„æ§åˆ¶å°å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.crazycake.shiro.exception.PrincipalInstanceException: class com.company.project.manage.entity.UserInfo must has getter for field: id</span><br><span class="line">We need a field to identify this Cache Object in Redis. So you need to defined an id field which you can get unique id to identify this principal. For example, if you use UserInfo as Principal class, the id field maybe userId, userName, email, etc. For example, getUserId(), getUserName(), getEmail(), etc.</span><br><span class="line">Default value is &quot;id&quot;, that means your principal object has a method called &quot;getId()&quot;</span><br></pre></td></tr></table></figure>
<p>å¤§æ¦‚æ„æ€å°±æ˜¯UserInfoå¯¹è±¡ä¸­å¿…é¡»è¦æœ‰idå±æ€§ï¼Œå¹¶ä¸”è¦æœ‰å¯¹åº”çš„getæ–¹æ³•ã€‚åœ¨èº«ä»½éªŒè¯çš„æ—¶å€™å°±å·²ç»å°†userinfoä¿¡æ¯ä¼ é€’ç»™äº†shiroï¼Œç„¶åredisåšç¼“å­˜çš„æ—¶å€™éœ€è¦keyï¼Œkeyçš„å€¼å°±ä¸userinfoé‡Œé¢çš„idå€¼æœ‰å…³ã€‚<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/5d634f7823c441ee80b9356c5024cce4.png" alt="image.png"><br>ç‚¹å¼€UserInfoå¯¹è±¡ä¸€çœ‹ï¼Œå°´äº†ä¸ªå°¬ï¼Œä¸»é”®çš„å‘½åä½¿ç”¨çš„æ˜¯uid<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/256e8900fd2c9cc5dfbb6629910f5775.png" alt="image.png"><br>æœ€åæŠŠä¸»é”®æ¢æˆidï¼Œå°±è¿è¡Œæ­£å¸¸äº†ã€‚</p>
<p>æ¼”ç¤ºé¡¹ç›®åœ¨æˆ‘çš„githubä¸Šé¢ï¼Œshiro-redisæ’ä»¶çš„æ•´åˆå¯ä»¥æŸ¥çœ‹ï¼š<br><a target="_blank" rel="noopener" href="https://mrbird.cc/Spring-Boot-Shiro%20cache.html">https://mrbird.cc/Spring-Boot-Shiro%20cache.html</a></p>

          
        
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>

  <hr/>

    
      

  

  
  
  
  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://ruiyeclub.cn/2022/06/01/SpringBoot%E6%95%B4%E5%90%88Hibernate-Validator%E5%AE%9E%E7%8E%B0%E5%8F%82%E6%95%B0%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruiyeclub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/06/01/SpringBoot%E6%95%B4%E5%90%88Hibernate-Validator%E5%AE%9E%E7%8E%B0%E5%8F%82%E6%95%B0%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD/" itemprop="url">SpringBootæ•´åˆHibernate Validatorå®ç°å‚æ•°éªŒè¯åŠŸèƒ½</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-01T09:34:37+08:00">
                2022-06-01
              </time>
            
          </span>

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ã€€ã€€åœ¨å‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ä¸­ï¼Œåç«¯å¯¹å‰ç«¯ä¼ å…¥çš„å‚æ•°çš„æ ¡éªŒæˆäº†å¿…ä¸å¯å°‘çš„ä¸€ä¸ªç¯èŠ‚ã€‚ä½†æ˜¯åœ¨å¤šå‚æ•°çš„æƒ…å†µä¸‹ï¼Œåœ¨controllerå±‚åŠ ä¸Šå‚æ•°éªŒè¯ï¼Œä¼šæ˜¾å¾—ç‰¹åˆ«è‡ƒè‚¿ï¼Œå¹¶ä¸”ä¼šæœ‰è®¸å¤šçš„é‡å¤ä»£ç ã€‚è¿™é‡Œå¯ä»¥å¼•ç”¨Hibernate Validatoræ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç›´æ¥åœ¨å®ä½“ç±»è¿›è¡Œå‚æ•°æ ¡éªŒï¼ŒéªŒè¯å¤±è´¥ç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ç»™å‰ç«¯ï¼Œå‡å°‘controllerå±‚çš„ä»£ç é‡ã€‚</p>
<h1 id="ä¸€ã€pomå¼•å…¥Hibernate-Validator"><a href="#ä¸€ã€pomå¼•å…¥Hibernate-Validator" class="headerlink" title="ä¸€ã€pomå¼•å…¥Hibernate Validator"></a>ä¸€ã€pomå¼•å…¥Hibernate Validator</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- éªŒè¯å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.5.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="äºŒã€é€šè¿‡æ³¨è§£åœ¨å®ä½“ç±»è¿›è¡Œå‚æ•°æ ¡éªŒ"><a href="#äºŒã€é€šè¿‡æ³¨è§£åœ¨å®ä½“ç±»è¿›è¡Œå‚æ•°æ ¡éªŒ" class="headerlink" title="äºŒã€é€šè¿‡æ³¨è§£åœ¨å®ä½“ç±»è¿›è¡Œå‚æ•°æ ¡éªŒ"></a>äºŒã€é€šè¿‡æ³¨è§£åœ¨å®ä½“ç±»è¿›è¡Œå‚æ•°æ ¡éªŒ</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserModel</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©ºï¼&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;ageä¸èƒ½ä¸ºnull!&quot;)</span></span><br><span class="line">    <span class="meta">@Range(min = 1, max = 888, message = &quot;èŒƒå›´ä¸º1è‡³888&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ—¥æœŸæ ¼å¼åŒ–è½¬æ¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;æ—¥æœŸä¸èƒ½ä¸ºnull!&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç”¨åˆ°çš„å‚æ•°æ ¡éªŒçš„æ³¨è§£æœ‰@NotNullå’Œ@Rangeï¼Œmessageæ˜¯åˆ°æ—¶å€™æˆ‘ä»¬è¿”å›ç»™å‰ç«¯çš„ä¿¡æ¯ï¼Œæ³¨è§£çš„å…·ä½“æ„æ€å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Null</span>  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º<span class="literal">null</span></span><br><span class="line"><span class="meta">@NotNull</span>  è¢«æ³¨é‡Šçš„å…ƒç´ ä¸èƒ½ä¸º<span class="literal">null</span></span><br><span class="line"><span class="meta">@AssertTrue</span>  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º<span class="literal">true</span></span><br><span class="line"><span class="meta">@AssertFalse</span>  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º<span class="literal">false</span></span><br><span class="line"><span class="meta">@Min(value)</span>  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼</span><br><span class="line"><span class="meta">@Max(value)</span>  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼</span><br><span class="line"><span class="meta">@DecimalMin(value)</span>  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼</span><br><span class="line"><span class="meta">@DecimalMax(value)</span>  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼</span><br><span class="line"><span class="meta">@Size(max,min)</span>  è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…ã€‚</span><br><span class="line"><span class="meta">@Digits(integer,fraction)</span>  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†…</span><br><span class="line"><span class="meta">@Past</span>  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ</span><br><span class="line"><span class="meta">@Future</span>  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ</span><br><span class="line"><span class="meta">@Pattern(value)</span> è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</span><br><span class="line"><span class="meta">@Email</span> è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ç”µå­é‚®ä»¶åœ°å€</span><br><span class="line"><span class="meta">@Length</span> è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…</span><br><span class="line"><span class="meta">@NotEmpty</span>  è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²å¿…é¡»éç©º</span><br><span class="line"><span class="meta">@Range</span>  è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†…</span><br></pre></td></tr></table></figure>
<h1 id="ä¸‰ã€controllerå±‚çš„æ–¹æ³•åŠ ä¸Š-Validæ³¨è§£"><a href="#ä¸‰ã€controllerå±‚çš„æ–¹æ³•åŠ ä¸Š-Validæ³¨è§£" class="headerlink" title="ä¸‰ã€controllerå±‚çš„æ–¹æ³•åŠ ä¸Š@Validæ³¨è§£"></a>ä¸‰ã€controllerå±‚çš„æ–¹æ³•åŠ ä¸Š@Validæ³¨è§£</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/testPost&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">testPost</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Valid</span> UserModel userModel, BindingResult result)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(result.hasErrors())&#123;</span><br><span class="line">        <span class="keyword">for</span>(ObjectError error:result.getAllErrors())&#123;</span><br><span class="line">            <span class="keyword">return</span> error.getDefaultMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> userModel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>controllerå±‚è¿™é‡Œåªéœ€è¦åœ¨å®ä½“ç±»çš„å‰é¢åŠ ä¸Š@Validæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£å¯ä»¥å®ç°æ•°æ®çš„éªŒè¯ã€‚è¿™é‡ŒBindingResultæ˜¯å­˜å‚¨äº†æ ¡éªŒæ—¶çš„é”™è¯¯ä¿¡æ¯ï¼ŒéªŒè¯æœ‰è¯¯æ—¶å°†é”™è¯¯ä¿¡æ¯è¿”å›ç»™å‰ç«¯ã€‚è¿™é‡Œä¸ä½¿ç”¨BindingResultçš„æ—¶å€™ï¼Œæ§åˆ¶å°ä¼šæŠ¥MethodArgumentNotValidExceptionï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰å¼‚å¸¸ç±»æ¥æ•æ‰å®ƒï¼Œç„¶åå»æ‰BindingResultï¼Œä»¥åŠéš¾çœ‹çš„ifåˆ¤æ–­ã€‚</p>
<h1 id="å››ã€è‡ªå®šä¹‰å¼‚å¸¸ç±»æ•æ‰MethodArgumentNotValidException"><a href="#å››ã€è‡ªå®šä¹‰å¼‚å¸¸ç±»æ•æ‰MethodArgumentNotValidException" class="headerlink" title="å››ã€è‡ªå®šä¹‰å¼‚å¸¸ç±»æ•æ‰MethodArgumentNotValidException"></a>å››ã€è‡ªå®šä¹‰å¼‚å¸¸ç±»æ•æ‰MethodArgumentNotValidException</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> JsonData <span class="title function_">validException</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        <span class="comment">//éªŒè¯postè¯·æ±‚çš„å‚æ•°åˆæ³•æ€§</span></span><br><span class="line">        <span class="type">MethodArgumentNotValidException</span> <span class="variable">notValidException</span> <span class="operator">=</span> e;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> notValidException.getBindingResult().getFieldError().getDefaultMessage();</span><br><span class="line">        <span class="keyword">return</span> JsonData.buildError(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨PostMançš„æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/0e7da5f5ea00deaf1e69196d09085f49.png" alt="image.png"></p>
<p>å…·ä½“çš„ä»£ç å¯ä»¥åœ¨æˆ‘çš„githubä¸Šé¢æŸ¥çœ‹ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/ruiyeclub/SpringBoot-Hello">https://github.com/ruiyeclub/SpringBoot-Hello</a></p>

          
        
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>

  <hr/>

    
      

  

  
  
  
  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://ruiyeclub.cn/2022/02/14/SpringBoot%E4%BD%BF%E7%94%A8Jwt%E5%A4%84%E7%90%86%E8%B7%A8%E5%9F%9F%E8%AE%A4%E8%AF%81%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruiyeclub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/02/14/SpringBoot%E4%BD%BF%E7%94%A8Jwt%E5%A4%84%E7%90%86%E8%B7%A8%E5%9F%9F%E8%AE%A4%E8%AF%81%E9%97%AE%E9%A2%98/" itemprop="url">SpringBootä½¿ç”¨Jwtå¤„ç†è·¨åŸŸè®¤è¯é—®é¢˜</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-02-14T17:35:40+08:00">
                2022-02-14
              </time>
            
          </span>

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ã€€ã€€åœ¨å‰åç«¯å¼€å‘æ—¶ä¸ºä»€ä¹ˆéœ€è¦ç”¨æˆ·è®¤è¯å‘¢ï¼ŸåŸå› æ˜¯ç”±äºHTTPåå®šæ˜¯ä¸å­˜å‚¨çŠ¶æ€çš„ï¼Œè¿™æ„å‘³ç€å½“æˆ‘ä»¬é€è¿‡è´¦å·å¯†ç éªŒè¯ä¸€ä¸ªä½¿ç”¨è€…æ—¶ï¼Œå½“ä¸‹ä¸€ä¸ªrequestè¯·æ±‚æ—¶ä»–å°±æŠŠåˆšåˆšçš„èµ„æ–™å¿˜è®°äº†ã€‚äºæ˜¯æˆ‘ä»¬çš„ç¨‹åºå°±ä¸çŸ¥é“è°æ˜¯è°äº†ã€‚ æ‰€ä»¥ä¸ºäº†ä¿è¯ç³»ç»Ÿçš„å®‰å…¨ï¼Œå°±éœ€è¦éªŒè¯ç”¨æˆ·æ˜¯å¦å¤„äºç™»é™†çŠ¶æ€ã€‚</p>
<h1 id="ä¸€ã€JWTçš„ç»„æˆ"><a href="#ä¸€ã€JWTçš„ç»„æˆ" class="headerlink" title="ä¸€ã€JWTçš„ç»„æˆ"></a>ä¸€ã€JWTçš„ç»„æˆ</h1><p>JWTç”±Headerã€Payloadã€Signatureä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«ç”¨.åˆ†éš”ã€‚</p>
<p>ä¸‹é¢å°±æ˜¯ä¸€ä¸ªjwtçœŸå®çš„æ ·å­ï¼Œè¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯é‡Œé¢å´å­˜å‚¨äº†å¾ˆé‡è¦çš„ä¿¡æ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJyYXljaGVuIiwiaWQiOjIsIm5hbWUiOiJyYXkiLCJwYXNzd29yZCI6IjMyMSIsImlhdCI6MTU5MDI5OTU0OCwiZXhwIjoxNTkwMzg1OTQ4fQ.ORJNldDIfffg7D3_xu0_dBWb16y4fPLtw_r6qgScFpQ</span><br></pre></td></tr></table></figure>
<p>Headerï¼š</p>
<blockquote>
<p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯è¯·æ±‚å¤´ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œalgä¸typ,ç¬¬ä¸€ä¸ªæŒ‡å®šçš„æ˜¯ç®—æ³•ï¼Œç¬¬äºŒæŒ‡å®šçš„æ˜¯ç±»å‹ã€‚</p>
</blockquote>
<p>Payload</p>
<blockquote>
<p>ç¬¬äºŒéƒ¨åˆ†æ˜¯ä¸»ä½“ä¿¡æ¯ç»„æˆ,ç”¨æ¥å­˜å‚¨JWTåŸºæœ¬ä¿¡æ¯ï¼Œæˆ–è€…æ˜¯æˆ‘ä»¬çš„ä¿¡æ¯ã€‚</p>
</blockquote>
<p>Signature</p>
<blockquote>
<p>ç¬¬ä¸‰éƒ¨åˆ†ä¸»è¦æ˜¯ç»™ç¬¬ä¸€éƒ¨åˆ†è·Ÿç¬¬äºŒéƒ¨è¿›è¡Œç­¾åä½¿ç”¨çš„,ç”¨æ¥éªŒè¯æ˜¯å¦æ˜¯æˆ‘ä»¬æœåŠ¡å™¨å‘èµ·çš„Tokenï¼Œsecretæ˜¯æˆ‘ä»¬çš„å¯†é’¥ã€‚</p>
</blockquote>
<h1 id="äºŒã€åœ¨springbooté¡¹ç›®ä¸­ä½¿ç”¨jwtåšéªŒè¯"><a href="#äºŒã€åœ¨springbooté¡¹ç›®ä¸­ä½¿ç”¨jwtåšéªŒè¯" class="headerlink" title="äºŒã€åœ¨springbooté¡¹ç›®ä¸­ä½¿ç”¨jwtåšéªŒè¯"></a>äºŒã€åœ¨springbooté¡¹ç›®ä¸­ä½¿ç”¨jwtåšéªŒè¯</h1><p>å…·ä½“æµç¨‹ï¼š</p>
<ul>
<li>æŠŠç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç å‘åˆ°åç«¯</li>
<li>åç«¯è¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒæˆåŠŸä¼šç”Ÿæˆtoken, æŠŠtokenå‘é€ç»™å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯è‡ªå·±ä¿å­˜token, å†æ¬¡è¯·æ±‚å°±è¦åœ¨Httpåè®®çš„è¯·æ±‚å¤´ä¸­å¸¦ç€tokenå»è®¿é—®æœåŠ¡ç«¯ï¼Œå’Œåœ¨æœåŠ¡ç«¯ä¿å­˜çš„tokenä¿¡æ¯è¿›è¡Œæ¯”å¯¹æ ¡éªŒã€‚</li>
</ul>
<p>1.å…ˆå¼•å…¥jaråŒ…</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2.ä½¿ç”¨å·¥å…·ç±»ç”Ÿæˆtokenå’ŒéªŒè¯tokenï¼ˆç”Ÿæˆtokenæ–¹æ³•ä¸­å­˜å…¥äº†ç”¨æˆ·çš„ä¿¡æ¯ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘è¡Œè€…</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUBJECT=<span class="string">&quot;raychen&quot;</span>;</span><br><span class="line">    <span class="comment">//è¿‡æœŸæ—¶é—´ ä¸€å¤©</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> EXPIRE=<span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>;</span><br><span class="line">    <span class="comment">//å¯†é’¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APPSECRET=<span class="string">&quot;raychen11&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆjwt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">geneJsonWebToken</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(user==<span class="literal">null</span> || user.getId()==<span class="literal">null</span> || user.getName()==<span class="literal">null</span> || user.getPassword()==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String token=Jwts.builder().setSubject(SUBJECT)</span><br><span class="line">                .claim(<span class="string">&quot;id&quot;</span>,user.getId())</span><br><span class="line">                .claim(<span class="string">&quot;name&quot;</span>,user.getName())</span><br><span class="line">                .claim(<span class="string">&quot;password&quot;</span>,user.getPassword())</span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">                .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis()+EXPIRE))</span><br><span class="line">                .signWith(SignatureAlgorithm.HS256,APPSECRET).compact();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¡éªŒtoken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Claims <span class="title function_">checkJWT</span><span class="params">(String token)</span>&#123;</span><br><span class="line">        <span class="comment">//ä»¿é€ çš„tokenæˆ–è€…å·²è¿‡æœŸå°±ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> Claims claims=Jwts.parser().setSigningKey(APPSECRET).parseClaimsJws(token).getBody();</span><br><span class="line">            <span class="keyword">return</span> claims;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;catch...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.è‡ªå®šä¹‰æ³¨è§£ï¼ˆè¿›è¡ŒtokenéªŒè¯ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CheckToken &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4.ç¼–å†™configï¼Œå°†åå°æ‰€æœ‰è¯·æ±‚å…ˆå»æ‹¦æˆªå™¨ï¼ˆæ‹¦æˆªå™¨è¿”å›äº†trueï¼Œç”¨æˆ·æ‰å¯ä»¥è¯·æ±‚åˆ°æ¥å£ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterceptorConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(authenticationInterceptor())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>);    <span class="comment">// æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œé€šè¿‡åˆ¤æ–­æ˜¯å¦æœ‰ @LoginRequired æ³¨è§£ å†³å®šæ˜¯å¦éœ€è¦ç™»å½•</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AuthenticationInterceptor <span class="title function_">authenticationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthenticationInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5.å®šä¹‰æ‹¦æˆªå™¨ï¼ˆå¯¹éœ€è¦tokenéªŒè¯çš„è¯·æ±‚ï¼Œè¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›falseæ— æ³•è¯·æ±‚åˆ°æ¥å£ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthenticationInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Gson gson=<span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿›å…¥controllerä¹‹å‰è¿›è¡Œæ‹¦æˆª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object object)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸æ˜¯æ˜ å°„åˆ°æ–¹æ³•ç›´æ¥é€šè¿‡</span></span><br><span class="line">        <span class="keyword">if</span> (!(object <span class="keyword">instanceof</span> HandlerMethod)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">HandlerMethod</span> <span class="variable">handlerMethod</span> <span class="operator">=</span> (HandlerMethod) object;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> handlerMethod.getMethod();</span><br><span class="line">        <span class="comment">//æ£€æŸ¥æ˜¯å¦æœ‰LoginTokenæ³¨é‡Šï¼Œæœ‰åˆ™è·³è¿‡è®¤è¯</span></span><br><span class="line">        <span class="keyword">if</span> (method.isAnnotationPresent(LoginToken.class)) &#123;</span><br><span class="line">            <span class="type">LoginToken</span> <span class="variable">loginToken</span> <span class="operator">=</span> method.getAnnotation(LoginToken.class);</span><br><span class="line">            <span class="keyword">if</span> (loginToken.required()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‰é¢æ˜¯ä¸éœ€è¦tokenéªŒè¯çš„ ä» http è¯·æ±‚å¤´ä¸­å–å‡º token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="comment">//æ£€æŸ¥æœ‰æ²¡æœ‰éœ€è¦ç”¨æˆ·æƒé™çš„æ³¨è§£</span></span><br><span class="line">        <span class="keyword">if</span> (method.isAnnotationPresent(CheckToken.class)) &#123;</span><br><span class="line">            <span class="type">CheckToken</span> <span class="variable">checkToken</span> <span class="operator">=</span> method.getAnnotation(CheckToken.class);</span><br><span class="line">            <span class="keyword">if</span> (checkToken.required()) &#123;</span><br><span class="line">                <span class="keyword">if</span>(token!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    Claims claims= JwtUtils.checkJWT(token);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="literal">null</span>==claims)&#123;</span><br><span class="line">                        sendJsonMessage(response, JsonData.buildError(<span class="string">&quot;tokenæœ‰è¯¯&quot;</span>));</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    Integer userId= (Integer) claims.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) claims.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">                    request.setAttribute(<span class="string">&quot;userId&quot;</span>,userId);</span><br><span class="line">                    request.setAttribute(<span class="string">&quot;name&quot;</span>,name);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//tokenä¸ºnullçš„è¯ è¿”å›ä¸€æ®µjsonç»™å‰ç«¯</span></span><br><span class="line">                sendJsonMessage(response, JsonData.buildError(<span class="string">&quot;è¯·ç™»å½•&quot;</span>));</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ²¡æœ‰ä½¿ç”¨æ³¨è§£çš„æ–¹æ³• ç›´æ¥è¿”å›true</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å“åº”æ•°æ®ç»™å‰ç«¯</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> obj</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendJsonMessage</span> <span class="params">(HttpServletResponse response, Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            response.setContentType(<span class="string">&quot;application/json; charset=utf-8&quot;</span>);</span><br><span class="line">            <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">            writer.print(gson.toJson(obj));</span><br><span class="line">            writer.close();</span><br><span class="line">            response.flushBuffer();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œä½¿ç”¨å·¥å…·ç±»ç”Ÿæˆtokenã€‚tokenåœ¨æœåŠ¡ç«¯ä¸åšå­˜å‚¨ï¼Œç›´æ¥å°†tokenè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¸‹æ¬¡è¯·æ±‚æœåŠ¡ç«¯æ—¶ï¼Œä½¿ç”¨å·¥å…·ç±»æ¥éªŒè¯headeré‡Œçš„tokenæ˜¯å¦åˆæ³•ã€‚</p>
<p>é¡¹ç›®ä»£ç åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/ruiyeclub/SpringBoot-Hello">https://github.com/ruiyeclub/SpringBoot-Hello</a></p>

          
        
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>

  <hr/>

    
      

  

  
  
  
  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://ruiyeclub.cn/2022/02/13/%E5%90%AF%E5%8A%A8%E9%A1%B9%E7%9B%AE%E6%8A%A5%E9%94%99Correct%20the%20classpath%20of%20your%20application%20so%20that%20it%20contains%20a%20single,%20compatible%20version%20of%20xxx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruiyeclub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/02/13/%E5%90%AF%E5%8A%A8%E9%A1%B9%E7%9B%AE%E6%8A%A5%E9%94%99Correct%20the%20classpath%20of%20your%20application%20so%20that%20it%20contains%20a%20single,%20compatible%20version%20of%20xxx/" itemprop="url">å¯åŠ¨é¡¹ç›®æŠ¥é”™Correct the classpath of your application so that it contains a single, compatible version of xxx</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-02-13T17:28:11+08:00">
                2022-02-13
              </time>
            
          </span>

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>é¡¹ç›®æ˜¯åŸºäºGradleæ„å»ºçš„ï¼Œåœ¨æ•´åˆswaggeråï¼Œå¯åŠ¨é¡¹ç›®æ—¶æŠ¥é”™äº†ã€‚æŠ¥é”™æ—¥å¿—ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Description:</span><br><span class="line"></span><br><span class="line">An attempt was made to call a method that does not exist. The attempt was made from the following location:</span><br><span class="line"></span><br><span class="line">    springfox.documentation.spring.web.plugins.DocumentationPluginsManager.createContextBuilder(DocumentationPluginsManager.java:<span class="number">152</span>)</span><br><span class="line"></span><br><span class="line">The following method did not exist:</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;org.springframework.plugin.core.Plugin org.springframework.plugin.core.PluginRegistry.getPluginFor(java.lang.Object, org.springframework.plugin.core.Plugin)&#x27;</span></span><br><span class="line"></span><br><span class="line">The method<span class="string">&#x27;s class, org.springframework.plugin.core.PluginRegistry, is available from the following locations:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    jar:file:/C:/Users/Administrator/.gradle/caches/modules-2/files-2.1/org.springframework.plugin/spring-plugin-core/2.0.0.RELEASE/95fc8c13037630f4aba9c51141f535becec00fe6/spring-plugin-core-2.0.0.RELEASE.jar!/org/springframework/plugin/core/PluginRegistry.class</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">It was loaded from the following location:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    file:/C:/Users/Administrator/.gradle/caches/modules-2/files-2.1/org.springframework.plugin/spring-plugin-core/2.0.0.RELEASE/95fc8c13037630f4aba9c51141f535becec00fe6/spring-plugin-core-2.0.0.RELEASE.jar</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Action:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Correct the classpath of your application so that it contains a single, compatible version of org.springframework.plugin.core.PluginRegistry</span></span><br></pre></td></tr></table></figure>
<p>ç™¾åº¦ä¹‹åï¼Œå‘ç°æ˜¯jaråŒ…å†²çªäº†ï¼Œå¯¼å…¥äº†ä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„jaråŒ…ã€‚å¦‚å›¾ï¼š<br><img src="https://ruiyeclub.oss-cn-shenzhen.aliyuncs.com/articles/a3688f4401c04f3a53efb72e701a4457.png" alt="image.png"><br>è§£å†³åŠæ³•å¯ä»¥ç›´æ¥å°†ä¾èµ–ä¸­çš„jaråŒ…å‰”é™¤æ‰ï¼Œæˆ–è€…ç›´æ¥åˆ é™¤è¯¥ä¾èµ–ä¹Ÿè¡Œã€‚</p>

          
        
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>

  <hr/>

    
      

  

  
  
  
  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://ruiyeclub.cn/2022/02/12/Redis%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93&%E5%8F%B2%E4%B8%8A%E6%9C%80%E5%85%A8Redis%E9%9D%A2%E8%AF%95%E9%A2%98%E5%8F%8A%E7%AD%94%E6%A1%88(%E8%BD%AC)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ruiyeclub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/02/12/Redis%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93&%E5%8F%B2%E4%B8%8A%E6%9C%80%E5%85%A8Redis%E9%9D%A2%E8%AF%95%E9%A2%98%E5%8F%8A%E7%AD%94%E6%A1%88(%E8%BD%AC)/" itemprop="url">Redisé¢è¯•æ€»ç»“&å²ä¸Šæœ€å…¨Redisé¢è¯•é¢˜åŠç­”æ¡ˆ(è½¬)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-02-12T17:35:40+08:00">
                2022-02-12
              </time>
            
          </span>

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Redis åœ¨äº’è”ç½‘æŠ€æœ¯å­˜å‚¨æ–¹é¢ä½¿ç”¨å¦‚æ­¤å¹¿æ³›ï¼Œå‡ ä¹æ‰€æœ‰çš„åç«¯æŠ€æœ¯é¢è¯•å®˜éƒ½è¦åœ¨ Redis çš„ä½¿ç”¨å’ŒåŸç†æ–¹é¢å¯¹å°ä¼™ä¼´ä»¬è¿›è¡Œå„ç§åˆéš¾ã€‚ä½œä¸ºä¸€ååœ¨äº’è”ç½‘æŠ€æœ¯è¡Œä¸šæ‰“å‡»è¿‡æˆç™¾ä¸Šåƒåã€è¯·å…è®¸æˆ‘å¤¸å¼ ä¸€ä¸‹ã€‘çš„èµ„æ·±æŠ€æœ¯é¢è¯•å®˜ï¼Œçœ‹è¿‡äº†æ— æ•°è½å¯çš„èº«å½±å¤±æœ›çš„ç¦»å¼€ï¼Œç•¥æ„Ÿæ„§ç–šï¼Œæ•…çŒ®ä¸Šæ­¤æ–‡ï¼Œå¸Œæœ›å„ä½è¯»è€…ä»¥åé¢è¯•åŠ¿å¦‚ç ´ç«¹ï¼Œæ°¸æ— å¤±è´¥ï¼</p>
<h3 id="Redis-æœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Ÿ"><a href="#Redis-æœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Ÿ" class="headerlink" title="Redis æœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Ÿ"></a>Redis æœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Ÿ</h3><p>å­—ç¬¦ä¸² Stringã€å­—å…¸ Hashã€åˆ—è¡¨ Listã€é›†åˆ Setã€æœ‰åºé›†åˆ SortedSetã€‚</p>
<p>å¦‚æœä½ æ˜¯ Redis ä¸­é«˜çº§ç”¨æˆ·ï¼Œè¿˜éœ€è¦åŠ ä¸Šä¸‹é¢å‡ ç§æ•°æ®ç»“æ„ HyperLogLogã€Geoã€Pub&#x2F;Subã€‚</p>
<p>å¦‚æœä½ è¯´è¿˜ç©è¿‡ Redis Moduleï¼Œåƒ BloomFilterï¼ŒRedisSearchï¼ŒRedis-MLï¼Œé¢è¯•å®˜å¾—çœ¼ç›å°±å¼€å§‹å‘äº®äº†ã€‚</p>
<h3 id="ä½¿ç”¨è¿‡-Redis-åˆ†å¸ƒå¼é”ä¹ˆï¼Œå®ƒæ˜¯ä»€ä¹ˆå›äº‹ï¼Ÿ"><a href="#ä½¿ç”¨è¿‡-Redis-åˆ†å¸ƒå¼é”ä¹ˆï¼Œå®ƒæ˜¯ä»€ä¹ˆå›äº‹ï¼Ÿ" class="headerlink" title="ä½¿ç”¨è¿‡ Redis åˆ†å¸ƒå¼é”ä¹ˆï¼Œå®ƒæ˜¯ä»€ä¹ˆå›äº‹ï¼Ÿ"></a>ä½¿ç”¨è¿‡ Redis åˆ†å¸ƒå¼é”ä¹ˆï¼Œå®ƒæ˜¯ä»€ä¹ˆå›äº‹ï¼Ÿ</h3><p>å…ˆæ‹¿ setnx æ¥äº‰æŠ¢é”ï¼ŒæŠ¢åˆ°ä¹‹åï¼Œå†ç”¨ expire ç»™é”åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´é˜²æ­¢é”å¿˜è®°äº†é‡Šæ”¾ã€‚</p>
<p>è¿™æ—¶å€™å¯¹æ–¹ä¼šå‘Šè¯‰ä½ è¯´ä½ å›ç­”å¾—ä¸é”™ï¼Œç„¶åæ¥ç€é—®å¦‚æœåœ¨ setnx ä¹‹åæ‰§è¡Œ expire ä¹‹å‰è¿›ç¨‹æ„å¤– crash æˆ–è€…è¦é‡å¯ç»´æŠ¤äº†ï¼Œé‚£ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p>
<p>è¿™æ—¶å€™ä½ è¦ç»™äºˆæƒŠè®¶çš„åé¦ˆï¼šå”‰ï¼Œæ˜¯å–”ï¼Œè¿™ä¸ªé”å°±æ°¸è¿œå¾—ä¸åˆ°é‡Šæ”¾äº†ã€‚ç´§æ¥ç€ä½ éœ€è¦æŠ“ä¸€æŠ“è‡ªå·±å¾—è„‘è¢‹ï¼Œæ•…ä½œæ€è€ƒç‰‡åˆ»ï¼Œå¥½åƒæ¥ä¸‹æ¥çš„ç»“æœæ˜¯ä½ ä¸»åŠ¨æ€è€ƒå‡ºæ¥çš„ï¼Œç„¶åå›ç­”ï¼šæˆ‘è®°å¾— set æŒ‡ä»¤æœ‰éå¸¸å¤æ‚çš„å‚æ•°ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯å¯ä»¥åŒæ—¶æŠŠ setnx å’Œ expire åˆæˆä¸€æ¡æŒ‡ä»¤æ¥ç”¨çš„ï¼å¯¹æ–¹è¿™æ—¶ä¼šæ˜¾éœ²ç¬‘å®¹ï¼Œå¿ƒé‡Œå¼€å§‹é»˜å¿µï¼šæ‘ï¼Œè¿™å°å­è¿˜ä¸é”™ã€‚</p>
<p>å‡å¦‚ Redis é‡Œé¢æœ‰ 1 äº¿ä¸ª keyï¼Œå…¶ä¸­æœ‰ 10w ä¸ª key æ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ</p>
<p>ä½¿ç”¨ keys æŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„ key åˆ—è¡¨ã€‚</p>
<p>å¯¹æ–¹æ¥ç€è¿½é—®ï¼šå¦‚æœè¿™ä¸ª redis æ­£åœ¨ç»™çº¿ä¸Šçš„ä¸šåŠ¡æä¾›æœåŠ¡ï¼Œé‚£ä½¿ç”¨ keys æŒ‡ä»¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<p>è¿™ä¸ªæ—¶å€™ä½ è¦å›ç­” redis å…³é”®çš„ä¸€ä¸ªç‰¹æ€§ï¼šredis çš„å•çº¿ç¨‹çš„ã€‚keys æŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ scan æŒ‡ä»¤ï¼Œscan æŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„ key åˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨ keys æŒ‡ä»¤é•¿ã€‚</p>
<h3 id="ä½¿ç”¨è¿‡-Redis-åšå¼‚æ­¥é˜Ÿåˆ—ä¹ˆï¼Œä½ æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ"><a href="#ä½¿ç”¨è¿‡-Redis-åšå¼‚æ­¥é˜Ÿåˆ—ä¹ˆï¼Œä½ æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ" class="headerlink" title="ä½¿ç”¨è¿‡ Redis åšå¼‚æ­¥é˜Ÿåˆ—ä¹ˆï¼Œä½ æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ"></a>ä½¿ç”¨è¿‡ Redis åšå¼‚æ­¥é˜Ÿåˆ—ä¹ˆï¼Œä½ æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ</h3><p>ä¸€èˆ¬ä½¿ç”¨ list ç»“æ„ä½œä¸ºé˜Ÿåˆ—ï¼Œrpush ç”Ÿäº§æ¶ˆæ¯ï¼Œlpop æ¶ˆè´¹æ¶ˆæ¯ã€‚å½“ lpop æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦é€‚å½“ sleep ä¸€ä¼šå†é‡è¯•ã€‚</p>
<p>å¦‚æœå¯¹æ–¹è¿½é—®å¯ä¸å¯ä»¥ä¸ç”¨ sleep å‘¢ï¼Ÿlist è¿˜æœ‰ä¸ªæŒ‡ä»¤å« blpopï¼Œåœ¨æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œå®ƒä¼šé˜»å¡ä½ç›´åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚</p>
<p>å¦‚æœå¯¹æ–¹è¿½é—®èƒ½ä¸èƒ½ç”Ÿäº§ä¸€æ¬¡æ¶ˆè´¹å¤šæ¬¡å‘¢ï¼Ÿä½¿ç”¨ pub&#x2F;sub ä¸»é¢˜è®¢é˜…è€…æ¨¡å¼ï¼Œå¯ä»¥å®ç° 1:N çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p>
<p>å¦‚æœå¯¹æ–¹è¿½é—® pub&#x2F;sub æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿåœ¨æ¶ˆè´¹è€…ä¸‹çº¿çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ï¼Œå¾—ä½¿ç”¨ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—å¦‚ rabbitmq ç­‰ã€‚</p>
<p>å¦‚æœå¯¹æ–¹è¿½é—® redis å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—ï¼Ÿæˆ‘ä¼°è®¡ç°åœ¨ä½ å¾ˆæƒ³æŠŠé¢è¯•å®˜ä¸€æ£’æ‰“æ­»å¦‚æœä½ æ‰‹ä¸Šæœ‰ä¸€æ ¹æ£’çƒæ£çš„è¯ï¼Œæ€ä¹ˆé—®çš„è¿™ä¹ˆè¯¦ç»†ã€‚ä½†æ˜¯ä½ å¾ˆå…‹åˆ¶ï¼Œç„¶åç¥æ€è‡ªè‹¥çš„å›ç­”é“ï¼šä½¿ç”¨ sortedsetï¼Œæ‹¿æ—¶é—´æˆ³ä½œä¸º scoreï¼Œæ¶ˆæ¯å†…å®¹ä½œä¸º key è°ƒç”¨ zadd æ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç”¨ zrangebyscore æŒ‡ä»¤è·å– N ç§’ä¹‹å‰çš„æ•°æ®è½®è¯¢è¿›è¡Œå¤„ç†ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œé¢è¯•å®˜æš—åœ°é‡Œå·²ç»å¯¹ä½ ç«–èµ·äº†å¤§æ‹‡æŒ‡ã€‚ä½†æ˜¯ä»–ä¸çŸ¥é“çš„æ˜¯æ­¤åˆ»ä½ å´ç«–èµ·äº†ä¸­æŒ‡ï¼Œåœ¨æ¤…å­èƒŒåã€‚</p>
<p>å¦‚æœæœ‰å¤§é‡çš„ key éœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</p>
<p>å¦‚æœå¤§é‡çš„ key è¿‡æœŸæ—¶é—´è®¾ç½®çš„è¿‡äºé›†ä¸­ï¼Œåˆ°è¿‡æœŸçš„é‚£ä¸ªæ—¶é—´ç‚¹ï¼Œredis å¯èƒ½ä¼šå‡ºç°çŸ­æš‚çš„å¡é¡¿ç°è±¡ã€‚ä¸€èˆ¬éœ€è¦åœ¨æ—¶é—´ä¸ŠåŠ ä¸€ä¸ªéšæœºå€¼ï¼Œä½¿å¾—è¿‡æœŸæ—¶é—´åˆ†æ•£ä¸€äº›ã€‚</p>
<h3 id="Redis-å¦‚ä½•åšæŒä¹…åŒ–çš„ï¼Ÿ"><a href="#Redis-å¦‚ä½•åšæŒä¹…åŒ–çš„ï¼Ÿ" class="headerlink" title="Redis å¦‚ä½•åšæŒä¹…åŒ–çš„ï¼Ÿ"></a>Redis å¦‚ä½•åšæŒä¹…åŒ–çš„ï¼Ÿ</h3><p>bgsave åšé•œåƒå…¨é‡æŒä¹…åŒ–ï¼Œaof åšå¢é‡æŒä¹…åŒ–ã€‚å› ä¸º bgsave ä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œä¸å¤Ÿå®æ—¶ï¼Œåœ¨åœæœºçš„æ—¶å€™ä¼šå¯¼è‡´å¤§é‡ä¸¢å¤±æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ aof æ¥é…åˆä½¿ç”¨ã€‚åœ¨ redis å®ä¾‹é‡å¯æ—¶ï¼Œä¼šä½¿ç”¨ bgsave æŒä¹…åŒ–æ–‡ä»¶é‡æ–°æ„å»ºå†…å­˜ï¼Œå†ä½¿ç”¨ aof é‡æ”¾è¿‘æœŸçš„æ“ä½œæŒ‡ä»¤æ¥å®ç°å®Œæ•´æ¢å¤é‡å¯ä¹‹å‰çš„çŠ¶æ€ã€‚</p>
<p>å¯¹æ–¹è¿½é—®é‚£å¦‚æœçªç„¶æœºå™¨æ‰ç”µä¼šæ€æ ·ï¼Ÿå–å†³äº aof æ—¥å¿— sync å±æ€§çš„é…ç½®ï¼Œå¦‚æœä¸è¦æ±‚æ€§èƒ½ï¼Œåœ¨æ¯æ¡å†™æŒ‡ä»¤æ—¶éƒ½ sync ä¸€ä¸‹ç£ç›˜ï¼Œå°±ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚ä½†æ˜¯åœ¨é«˜æ€§èƒ½çš„è¦æ±‚ä¸‹æ¯æ¬¡éƒ½ sync æ˜¯ä¸ç°å®çš„ï¼Œä¸€èˆ¬éƒ½ä½¿ç”¨å®šæ—¶ syncï¼Œæ¯”å¦‚ 1s1 æ¬¡ï¼Œè¿™ä¸ªæ—¶å€™æœ€å¤šå°±ä¼šä¸¢å¤± 1s çš„æ•°æ®ã€‚</p>
<p>å¯¹æ–¹è¿½é—® bgsave çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿä½ ç»™å‡ºä¸¤ä¸ªè¯æ±‡å°±å¯ä»¥äº†ï¼Œfork å’Œ cowã€‚fork æ˜¯æŒ‡ redis é€šè¿‡åˆ›å»ºå­è¿›ç¨‹æ¥è¿›è¡Œ bgsave æ“ä½œï¼Œcow æŒ‡çš„æ˜¯ copy on writeï¼Œå­è¿›ç¨‹åˆ›å»ºåï¼Œçˆ¶å­è¿›ç¨‹å…±äº«æ•°æ®æ®µï¼Œçˆ¶è¿›ç¨‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ï¼Œå†™è„çš„é¡µé¢æ•°æ®ä¼šé€æ¸å’Œå­è¿›ç¨‹åˆ†ç¦»å¼€æ¥ã€‚</p>
<h3 id="Pipeline-æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨-pipelineï¼Ÿ"><a href="#Pipeline-æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨-pipelineï¼Ÿ" class="headerlink" title="Pipeline æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ pipelineï¼Ÿ"></a>Pipeline æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ pipelineï¼Ÿ</h3><p>å¯ä»¥å°†å¤šæ¬¡ IO å¾€è¿”çš„æ—¶é—´ç¼©å‡ä¸ºä¸€æ¬¡ï¼Œå‰ææ˜¯ pipeline æ‰§è¡Œçš„æŒ‡ä»¤ä¹‹é—´æ²¡æœ‰å› æœç›¸å…³æ€§ã€‚ä½¿ç”¨ redis-benchmark è¿›è¡Œå‹æµ‹çš„æ—¶å€™å¯ä»¥å‘ç°å½±å“ redis çš„ QPS å³°å€¼çš„ä¸€ä¸ªé‡è¦å› ç´ æ˜¯ pipeline æ‰¹æ¬¡æŒ‡ä»¤çš„æ•°ç›®ã€‚</p>
<h3 id="Redis-çš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ"><a href="#Redis-çš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ" class="headerlink" title="Redis çš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ"></a>Redis çš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ</h3><p>Redis å¯ä»¥ä½¿ç”¨ä¸»ä»åŒæ­¥ï¼Œä»ä»åŒæ­¥ã€‚ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œä¸»èŠ‚ç‚¹åšä¸€æ¬¡ bgsaveï¼Œå¹¶åŒæ—¶å°†åç»­ä¿®æ”¹æ“ä½œè®°å½•åˆ°å†…å­˜ bufferï¼Œå¾…å®Œæˆåå°† rdb æ–‡ä»¶å…¨é‡åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹ï¼Œå¤åˆ¶èŠ‚ç‚¹æ¥å—å®Œæˆåå°† rdb é•œåƒåŠ è½½åˆ°å†…å­˜ã€‚åŠ è½½å®Œæˆåï¼Œå†é€šçŸ¥ä¸»èŠ‚ç‚¹å°†æœŸé—´ä¿®æ”¹çš„æ“ä½œè®°å½•åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹è¿›è¡Œé‡æ”¾å°±å®Œæˆäº†åŒæ­¥è¿‡ç¨‹ã€‚</p>
<h3 id="æ˜¯å¦ä½¿ç”¨è¿‡-Redis-é›†ç¾¤ï¼Œé›†ç¾¤çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ˜¯å¦ä½¿ç”¨è¿‡-Redis-é›†ç¾¤ï¼Œé›†ç¾¤çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ˜¯å¦ä½¿ç”¨è¿‡ Redis é›†ç¾¤ï¼Œé›†ç¾¤çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ˜¯å¦ä½¿ç”¨è¿‡ Redis é›†ç¾¤ï¼Œé›†ç¾¤çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>Redis Sentinal ç€çœ¼äºé«˜å¯ç”¨ï¼Œåœ¨ master å®•æœºæ—¶ä¼šè‡ªåŠ¨å°† slave æå‡ä¸º masterï¼Œç»§ç»­æä¾›æœåŠ¡ã€‚</p>
<p>Redis Cluster ç€çœ¼äºæ‰©å±•æ€§ï¼Œåœ¨å•ä¸ª redis å†…å­˜ä¸è¶³æ—¶ï¼Œä½¿ç”¨ Cluster è¿›è¡Œåˆ†ç‰‡å­˜å‚¨ã€‚</p>
<h2 id="å²ä¸Šæœ€å…¨Redisé¢è¯•é¢˜åŠç­”æ¡ˆ"><a href="#å²ä¸Šæœ€å…¨Redisé¢è¯•é¢˜åŠç­”æ¡ˆ" class="headerlink" title="å²ä¸Šæœ€å…¨Redisé¢è¯•é¢˜åŠç­”æ¡ˆ"></a>å²ä¸Šæœ€å…¨Redisé¢è¯•é¢˜åŠç­”æ¡ˆ</h2><p>1ã€ä»€ä¹ˆæ˜¯Redisï¼Ÿ</p>
<p>Redisæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªKey-Valueç±»å‹çš„å†…å­˜æ•°æ®åº“ï¼Œå¾ˆåƒmemcachedï¼Œæ•´ä¸ªæ•°æ®åº“ç»Ÿç»ŸåŠ è½½åœ¨å†…å­˜å½“ä¸­è¿›è¡Œæ“ä½œï¼Œå®šæœŸé€šè¿‡å¼‚æ­¥æ“ä½œæŠŠæ•°æ®åº“æ•°æ®flushåˆ°ç¡¬ç›˜ä¸Šè¿›è¡Œä¿å­˜ã€‚å› ä¸ºæ˜¯çº¯å†…å­˜æ“ä½œï¼ŒRedisçš„æ€§èƒ½éå¸¸å‡ºè‰²ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„Key-Value DBã€‚ Redisçš„å‡ºè‰²ä¹‹å¤„ä¸ä»…ä»…æ˜¯æ€§èƒ½ï¼ŒRedisæœ€å¤§çš„é­…åŠ›æ˜¯æ”¯æŒä¿å­˜å¤šç§æ•°æ®ç»“æ„ï¼Œæ­¤å¤–å•ä¸ªvalueçš„æœ€å¤§é™åˆ¶æ˜¯1GBï¼Œä¸åƒ memcachedåªèƒ½ä¿å­˜1MBçš„æ•°æ®ï¼Œå› æ­¤Rediså¯ä»¥ç”¨æ¥å®ç°å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”æ–¹è¯´ç”¨ä»–çš„Listæ¥åšFIFOåŒå‘é“¾è¡¨ï¼Œå®ç°ä¸€ä¸ªè½»é‡çº§çš„é«˜æ€§ èƒ½æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ï¼Œç”¨ä»–çš„Setå¯ä»¥åšé«˜æ€§èƒ½çš„tagç³»ç»Ÿç­‰ç­‰ã€‚å¦å¤–Redisä¹Ÿå¯ä»¥å¯¹å­˜å…¥çš„Key-Valueè®¾ç½®expireæ—¶é—´ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¢«å½“ä½œä¸€ ä¸ªåŠŸèƒ½åŠ å¼ºç‰ˆçš„memcachedæ¥ç”¨ã€‚ Redisçš„ä¸»è¦ç¼ºç‚¹æ˜¯æ•°æ®åº“å®¹é‡å—åˆ°ç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œä¸èƒ½ç”¨ä½œæµ·é‡æ•°æ®çš„é«˜æ€§èƒ½è¯»å†™ï¼Œå› æ­¤Redisé€‚åˆçš„åœºæ™¯ä¸»è¦å±€é™åœ¨è¾ƒå°æ•°æ®é‡çš„é«˜æ€§èƒ½æ“ä½œå’Œè¿ç®—ä¸Šã€‚</p>
<p>2ã€Redisç›¸æ¯”memcachedæœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ</p>
<p>(1) memcachedæ‰€æœ‰çš„å€¼å‡æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ï¼Œredisä½œä¸ºå…¶æ›¿ä»£è€…ï¼Œæ”¯æŒæ›´ä¸ºä¸°å¯Œçš„æ•°æ®ç±»å‹</p>
<p>(2) redisçš„é€Ÿåº¦æ¯”memcachedå¿«å¾ˆå¤š</p>
<p>(3) rediså¯ä»¥æŒä¹…åŒ–å…¶æ•°æ®</p>
<p>3ã€Redisæ”¯æŒå“ªå‡ ç§æ•°æ®ç±»å‹ï¼Ÿ</p>
<p>Stringã€Listã€Setã€Sorted Setã€hashes</p>
<p>4ã€Redisä¸»è¦æ¶ˆè€—ä»€ä¹ˆç‰©ç†èµ„æºï¼Ÿ</p>
<p>å†…å­˜ã€‚</p>
<p>5ã€Redisçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>Remote Dictionary Serverã€‚</p>
<p>6ã€Redisæœ‰å“ªå‡ ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Ÿ</p>
<p>noeviction:è¿”å›é”™è¯¯å½“å†…å­˜é™åˆ¶è¾¾åˆ°å¹¶ä¸”å®¢æˆ·ç«¯å°è¯•æ‰§è¡Œä¼šè®©æ›´å¤šå†…å­˜è¢«ä½¿ç”¨çš„å‘½ä»¤ï¼ˆå¤§éƒ¨åˆ†çš„å†™å…¥æŒ‡ä»¤ï¼Œä½†DELå’Œå‡ ä¸ªä¾‹å¤–ï¼‰</p>
<p>allkeys-lru: å°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆLRUï¼‰ï¼Œä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚</p>
<p>volatile-lru: å°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆLRUï¼‰ï¼Œä½†ä»…é™äºåœ¨è¿‡æœŸé›†åˆçš„é”®,ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚</p>
<p>allkeys-random: å›æ”¶éšæœºçš„é”®ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚</p>
<p>volatile-random: å›æ”¶éšæœºçš„é”®ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ï¼Œä½†ä»…é™äºåœ¨è¿‡æœŸé›†åˆçš„é”®ã€‚</p>
<p>volatile-ttl: å›æ”¶åœ¨è¿‡æœŸé›†åˆçš„é”®ï¼Œå¹¶ä¸”ä¼˜å…ˆå›æ”¶å­˜æ´»æ—¶é—´ï¼ˆTTLï¼‰è¾ƒçŸ­çš„é”®,ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚</p>
<p>7ã€Rediså®˜æ–¹ä¸ºä»€ä¹ˆä¸æä¾›Windowsç‰ˆæœ¬ï¼Ÿ</p>
<p>å› ä¸ºç›®å‰Linuxç‰ˆæœ¬å·²ç»ç›¸å½“ç¨³å®šï¼Œè€Œä¸”ç”¨æˆ·é‡å¾ˆå¤§ï¼Œæ— éœ€å¼€å‘windowsç‰ˆæœ¬ï¼Œåè€Œä¼šå¸¦æ¥å…¼å®¹æ€§ç­‰é—®é¢˜ã€‚</p>
<p>8ã€ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼èƒ½å­˜å‚¨æœ€å¤§å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>512M</p>
<p>9ã€ä¸ºä»€ä¹ˆRediséœ€è¦æŠŠæ‰€æœ‰æ•°æ®æ”¾åˆ°å†…å­˜ä¸­ï¼Ÿ</p>
<p>Redisä¸ºäº†è¾¾åˆ°æœ€å¿«çš„è¯»å†™é€Ÿåº¦å°†æ•°æ®éƒ½è¯»åˆ°å†…å­˜ä¸­ï¼Œå¹¶é€šè¿‡å¼‚æ­¥çš„æ–¹å¼å°†æ•°æ®å†™å…¥ç£ç›˜ã€‚æ‰€ä»¥rediså…·æœ‰å¿«é€Ÿå’Œæ•°æ®æŒä¹…åŒ–çš„ç‰¹å¾ã€‚å¦‚æœä¸å°†æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œç£ç›˜I&#x2F;Oé€Ÿåº¦ä¸ºä¸¥é‡å½±å“redisçš„æ€§èƒ½ã€‚åœ¨å†…å­˜è¶Šæ¥è¶Šä¾¿å®œçš„ä»Šå¤©ï¼Œrediså°†ä¼šè¶Šæ¥è¶Šå—æ¬¢è¿ã€‚ å¦‚æœè®¾ç½®äº†æœ€å¤§ä½¿ç”¨çš„å†…å­˜ï¼Œåˆ™æ•°æ®å·²æœ‰è®°å½•æ•°è¾¾åˆ°å†…å­˜é™å€¼åä¸èƒ½ç»§ç»­æ’å…¥æ–°å€¼ã€‚</p>
<p>10ã€Redisé›†ç¾¤æ–¹æ¡ˆåº”è¯¥æ€ä¹ˆåšï¼Ÿéƒ½æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ</p>
<p>1.twemproxyï¼Œå¤§æ¦‚æ¦‚å¿µæ˜¯ï¼Œå®ƒç±»ä¼¼äºä¸€ä¸ªä»£ç†æ–¹å¼ï¼Œä½¿ç”¨æ–¹æ³•å’Œæ™®é€šredisæ— ä»»ä½•åŒºåˆ«ï¼Œè®¾ç½®å¥½å®ƒä¸‹å±çš„å¤šä¸ªrediså®ä¾‹åï¼Œä½¿ç”¨æ—¶åœ¨æœ¬éœ€è¦è¿æ¥redisçš„åœ°æ–¹æ”¹ä¸ºè¿æ¥twemproxyï¼Œå®ƒä¼šä»¥ä¸€ä¸ªä»£ç†çš„èº«ä»½æ¥æ”¶è¯·æ±‚å¹¶ä½¿ç”¨ä¸€è‡´æ€§hashç®—æ³•ï¼Œå°†è¯·æ±‚è½¬æ¥åˆ°å…·ä½“redisï¼Œå°†ç»“æœå†è¿”å›twemproxyã€‚ä½¿ç”¨æ–¹å¼ç®€ä¾¿(ç›¸å¯¹redisåªéœ€ä¿®æ”¹è¿æ¥ç«¯å£)ï¼Œå¯¹æ—§é¡¹ç›®æ‰©å±•çš„é¦–é€‰ã€‚ é—®é¢˜ï¼štwemproxyè‡ªèº«å•ç«¯å£å®ä¾‹çš„å‹åŠ›ï¼Œä½¿ç”¨ä¸€è‡´æ€§hashåï¼Œå¯¹redisèŠ‚ç‚¹æ•°é‡æ”¹å˜æ—¶å€™çš„è®¡ç®—å€¼çš„æ”¹å˜ï¼Œæ•°æ®æ— æ³•è‡ªåŠ¨ç§»åŠ¨åˆ°æ–°çš„èŠ‚ç‚¹ã€‚</p>
<p>2.codisï¼Œç›®å‰ç”¨çš„æœ€å¤šçš„é›†ç¾¤æ–¹æ¡ˆï¼ŒåŸºæœ¬å’Œtwemproxyä¸€è‡´çš„æ•ˆæœï¼Œä½†å®ƒæ”¯æŒåœ¨ èŠ‚ç‚¹æ•°é‡æ”¹å˜æƒ…å†µä¸‹ï¼Œæ—§èŠ‚ç‚¹æ•°æ®å¯æ¢å¤åˆ°æ–°hashèŠ‚ç‚¹ã€‚</p>
<p>3.redis cluster3.0è‡ªå¸¦çš„é›†ç¾¤ï¼Œç‰¹ç‚¹åœ¨äºä»–çš„åˆ†å¸ƒå¼ç®—æ³•ä¸æ˜¯ä¸€è‡´æ€§hashï¼Œè€Œæ˜¯hashæ§½çš„æ¦‚å¿µï¼Œä»¥åŠè‡ªèº«æ”¯æŒèŠ‚ç‚¹è®¾ç½®ä»èŠ‚ç‚¹ã€‚å…·ä½“çœ‹å®˜æ–¹æ–‡æ¡£ä»‹ç»ã€‚</p>
<p>4.åœ¨ä¸šåŠ¡ä»£ç å±‚å®ç°ï¼Œèµ·å‡ ä¸ªæ¯«æ— å…³è”çš„rediså®ä¾‹ï¼Œåœ¨ä»£ç å±‚ï¼Œå¯¹key è¿›è¡Œhashè®¡ç®—ï¼Œç„¶åå»å¯¹åº”çš„rediså®ä¾‹æ“ä½œæ•°æ®ã€‚ è¿™ç§æ–¹å¼å¯¹hashå±‚ä»£ç è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè€ƒè™‘éƒ¨åˆ†åŒ…æ‹¬ï¼ŒèŠ‚ç‚¹å¤±æ•ˆåçš„æ›¿ä»£ç®—æ³•æ–¹æ¡ˆï¼Œæ•°æ®éœ‡è¡åçš„è‡ªåŠ¨è„šæœ¬æ¢å¤ï¼Œå®ä¾‹çš„ç›‘æ§ï¼Œç­‰ç­‰ã€‚</p>
<p>11ã€Redisé›†ç¾¤æ–¹æ¡ˆä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨ï¼Ÿ</p>
<p>æœ‰Aï¼ŒBï¼ŒCä¸‰ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤,åœ¨æ²¡æœ‰å¤åˆ¶æ¨¡å‹çš„æƒ…å†µä¸‹,å¦‚æœèŠ‚ç‚¹Bå¤±è´¥äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±ä¼šä»¥ä¸ºç¼ºå°‘5501-11000è¿™ä¸ªèŒƒå›´çš„æ§½è€Œä¸å¯ç”¨ã€‚</p>
<p>12ã€MySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Ÿ</p>
<p>rediså†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šæ–½è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚</p>
<p>13ã€Redisæœ‰å“ªäº›é€‚åˆçš„åœºæ™¯ï¼Ÿ</p>
<p>ï¼ˆ1ï¼‰ã€ä¼šè¯ç¼“å­˜ï¼ˆSession Cacheï¼‰</p>
<p>æœ€å¸¸ç”¨çš„ä¸€ç§ä½¿ç”¨Redisçš„æƒ…æ™¯æ˜¯ä¼šè¯ç¼“å­˜ï¼ˆsession cacheï¼‰ã€‚ç”¨Redisç¼“å­˜ä¼šè¯æ¯”å…¶ä»–å­˜å‚¨ï¼ˆå¦‚Memcachedï¼‰çš„ä¼˜åŠ¿åœ¨äºï¼šRedisæä¾›æŒä¹…åŒ–ã€‚å½“ç»´æŠ¤ä¸€ä¸ªä¸æ˜¯ä¸¥æ ¼è¦æ±‚ä¸€è‡´æ€§çš„ç¼“å­˜æ—¶ï¼Œå¦‚æœç”¨æˆ·çš„è´­ç‰©è½¦ä¿¡æ¯å…¨éƒ¨ä¸¢å¤±ï¼Œå¤§éƒ¨åˆ†äººéƒ½ä¼šä¸é«˜å…´çš„ï¼Œç°åœ¨ï¼Œä»–ä»¬è¿˜ä¼šè¿™æ ·å—ï¼Ÿ</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œéšç€ Redis è¿™äº›å¹´çš„æ”¹è¿›ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°æ€ä¹ˆæ°å½“çš„ä½¿ç”¨Redisæ¥ç¼“å­˜ä¼šè¯çš„æ–‡æ¡£ã€‚ç”šè‡³å¹¿ä¸ºäººçŸ¥çš„å•†ä¸šå¹³å°Magentoä¹Ÿæä¾›Redisçš„æ’ä»¶ã€‚</p>
<p>ï¼ˆ2ï¼‰ã€å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰</p>
<p>é™¤åŸºæœ¬çš„ä¼šè¯tokenä¹‹å¤–ï¼ŒRedisè¿˜æä¾›å¾ˆç®€ä¾¿çš„FPCå¹³å°ã€‚å›åˆ°ä¸€è‡´æ€§é—®é¢˜ï¼Œå³ä½¿é‡å¯äº†Rediså®ä¾‹ï¼Œå› ä¸ºæœ‰ç£ç›˜çš„æŒä¹…åŒ–ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šçœ‹åˆ°é¡µé¢åŠ è½½é€Ÿåº¦çš„ä¸‹é™ï¼Œè¿™æ˜¯ä¸€ä¸ªæå¤§æ”¹è¿›ï¼Œç±»ä¼¼PHPæœ¬åœ°FPCã€‚</p>
<p>å†æ¬¡ä»¥Magentoä¸ºä¾‹ï¼ŒMagentoæä¾›ä¸€ä¸ªæ’ä»¶æ¥ä½¿ç”¨Redisä½œä¸ºå…¨é¡µç¼“å­˜åç«¯ã€‚</p>
<p>æ­¤å¤–ï¼Œå¯¹WordPressçš„ç”¨æˆ·æ¥è¯´ï¼ŒPantheonæœ‰ä¸€ä¸ªéå¸¸å¥½çš„æ’ä»¶ wp-redisï¼Œè¿™ä¸ªæ’ä»¶èƒ½å¸®åŠ©ä½ ä»¥æœ€å¿«é€Ÿåº¦åŠ è½½ä½ æ›¾æµè§ˆè¿‡çš„é¡µé¢ã€‚</p>
<p>ï¼ˆ3ï¼‰ã€é˜Ÿåˆ—</p>
<p>Reidsåœ¨å†…å­˜å­˜å‚¨å¼•æ“é¢†åŸŸçš„ä¸€å¤§ä¼˜ç‚¹æ˜¯æä¾› list å’Œ set æ“ä½œï¼Œè¿™ä½¿å¾—Redisèƒ½ä½œä¸ºä¸€ä¸ªå¾ˆå¥½çš„æ¶ˆæ¯é˜Ÿåˆ—å¹³å°æ¥ä½¿ç”¨ã€‚Redisä½œä¸ºé˜Ÿåˆ—ä½¿ç”¨çš„æ“ä½œï¼Œå°±ç±»ä¼¼äºæœ¬åœ°ç¨‹åºè¯­è¨€ï¼ˆå¦‚Pythonï¼‰å¯¹ list çš„ push&#x2F;pop æ“ä½œã€‚</p>
<p>å¦‚æœä½ å¿«é€Ÿçš„åœ¨Googleä¸­æœç´¢â€œRedis queuesâ€ï¼Œä½ é©¬ä¸Šå°±èƒ½æ‰¾åˆ°å¤§é‡çš„å¼€æºé¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®çš„ç›®çš„å°±æ˜¯åˆ©ç”¨Redisåˆ›å»ºéå¸¸å¥½çš„åç«¯å·¥å…·ï¼Œä»¥æ»¡è¶³å„ç§é˜Ÿåˆ—éœ€æ±‚ã€‚ä¾‹å¦‚ï¼ŒCeleryæœ‰ä¸€ä¸ªåå°å°±æ˜¯ä½¿ç”¨Redisä½œä¸ºbrokerï¼Œä½ å¯ä»¥ä»è¿™é‡Œå»æŸ¥çœ‹ã€‚</p>
<p>ï¼ˆ4ï¼‰ï¼Œæ’è¡Œæ¦œ&#x2F;è®¡æ•°å™¨</p>
<p>Redisåœ¨å†…å­˜ä¸­å¯¹æ•°å­—è¿›è¡Œé€’å¢æˆ–é€’å‡çš„æ“ä½œå®ç°çš„éå¸¸å¥½ã€‚é›†åˆï¼ˆSetï¼‰å’Œæœ‰åºé›†åˆï¼ˆSorted Setï¼‰ä¹Ÿä½¿å¾—æˆ‘ä»¬åœ¨æ‰§è¡Œè¿™äº›æ“ä½œçš„æ—¶å€™å˜çš„éå¸¸ç®€å•ï¼ŒRedisåªæ˜¯æ­£å¥½æä¾›äº†è¿™ä¸¤ç§æ•°æ®ç»“æ„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ä»æ’åºé›†åˆä¸­è·å–åˆ°æ’åæœ€é å‰çš„10ä¸ªç”¨æˆ·â€“æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œuser_scoresâ€ï¼Œæˆ‘ä»¬åªéœ€è¦åƒä¸‹é¢ä¸€æ ·æ‰§è¡Œå³å¯ï¼š</p>
<p>å½“ç„¶ï¼Œè¿™æ˜¯å‡å®šä½ æ˜¯æ ¹æ®ä½ ç”¨æˆ·çš„åˆ†æ•°åšé€’å¢çš„æ’åºã€‚å¦‚æœä½ æƒ³è¿”å›ç”¨æˆ·åŠç”¨æˆ·çš„åˆ†æ•°ï¼Œä½ éœ€è¦è¿™æ ·æ‰§è¡Œï¼š</p>
<p>ZRANGE user_scores 0 10 WITHSCORES</p>
<p>Agora Gameså°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œç”¨Rubyå®ç°çš„ï¼Œå®ƒçš„æ’è¡Œæ¦œå°±æ˜¯ä½¿ç”¨Redisæ¥å­˜å‚¨æ•°æ®çš„ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ã€‚</p>
<p>ï¼ˆ5ï¼‰ã€å‘å¸ƒ&#x2F;è®¢é˜…</p>
<p>æœ€åï¼ˆä½†è‚¯å®šä¸æ˜¯æœ€ä¸é‡è¦çš„ï¼‰æ˜¯Redisçš„å‘å¸ƒ&#x2F;è®¢é˜…åŠŸèƒ½ã€‚å‘å¸ƒ&#x2F;è®¢é˜…çš„ä½¿ç”¨åœºæ™¯ç¡®å®éå¸¸å¤šã€‚æˆ‘å·²çœ‹è§äººä»¬åœ¨ç¤¾äº¤ç½‘ç»œè¿æ¥ä¸­ä½¿ç”¨ï¼Œè¿˜å¯ä½œä¸ºåŸºäºå‘å¸ƒ&#x2F;è®¢é˜…çš„è„šæœ¬è§¦å‘å™¨ï¼Œç”šè‡³ç”¨Redisçš„å‘å¸ƒ&#x2F;è®¢é˜…åŠŸèƒ½æ¥å»ºç«‹èŠå¤©ç³»ç»Ÿï¼ï¼ˆä¸ï¼Œè¿™æ˜¯çœŸçš„ï¼Œä½ å¯ä»¥å»æ ¸å®ï¼‰ã€‚</p>
<p>14ã€Redisæ”¯æŒçš„Javaå®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿå®˜æ–¹æ¨èç”¨å“ªä¸ªï¼Ÿ</p>
<p>Redissonã€Jedisã€lettuceç­‰ç­‰ï¼Œå®˜æ–¹æ¨èä½¿ç”¨Redissonã€‚</p>
<p>15ã€Rediså’ŒRedissonæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>
<p>Redissonæ˜¯ä¸€ä¸ªé«˜çº§çš„åˆ†å¸ƒå¼åè°ƒRediså®¢æœç«¯ï¼Œèƒ½å¸®åŠ©ç”¨æˆ·åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­è½»æ¾å®ç°ä¸€äº›Javaçš„å¯¹è±¡ (Bloom filter, BitSet, Set, SetMultimap, ScoredSortedSet, SortedSet, Map, ConcurrentMap, List, ListMultimap, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, ReadWriteLock, AtomicLong, CountDownLatch, Publish &#x2F; Subscribe, HyperLogLog)ã€‚</p>
<p>16ã€Jedisä¸Redissonå¯¹æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</p>
<p>Jedisæ˜¯Redisçš„Javaå®ç°çš„å®¢æˆ·ç«¯ï¼Œå…¶APIæä¾›äº†æ¯”è¾ƒå…¨é¢çš„Rediså‘½ä»¤çš„æ”¯æŒï¼›Redissonå®ç°äº†åˆ†å¸ƒå¼å’Œå¯æ‰©å±•çš„Javaæ•°æ®ç»“æ„ï¼Œå’ŒJedisç›¸æ¯”ï¼ŒåŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸æ”¯æŒå­—ç¬¦ä¸²æ“ä½œï¼Œä¸æ”¯æŒæ’åºã€äº‹åŠ¡ã€ç®¡é“ã€åˆ†åŒºç­‰Redisç‰¹æ€§ã€‚Redissonçš„å®—æ—¨æ˜¯ä¿ƒè¿›ä½¿ç”¨è€…å¯¹Redisçš„å…³æ³¨åˆ†ç¦»ï¼Œä»è€Œè®©ä½¿ç”¨è€…èƒ½å¤Ÿå°†ç²¾åŠ›æ›´é›†ä¸­åœ°æ”¾åœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ä¸Šã€‚</p>
<p>17ã€Rediså¦‚ä½•è®¾ç½®å¯†ç åŠéªŒè¯å¯†ç ï¼Ÿ</p>
<p>è®¾ç½®å¯†ç ï¼šconfig set requirepass 123456</p>
<p>æˆæƒå¯†ç ï¼šauth 123456</p>
<p>18ã€è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Ÿ</p>
<p>Redisé›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hash,è€Œæ˜¯å¼•å…¥äº†å“ˆå¸Œæ§½çš„æ¦‚å¿µï¼ŒRedisé›†ç¾¤æœ‰16384ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªkeyé€šè¿‡CRC16æ ¡éªŒåå¯¹16384å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ï¼Œé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½ã€‚</p>
<p>19ã€Redisé›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ</p>
<p>ä¸ºäº†ä½¿åœ¨éƒ¨åˆ†èŠ‚ç‚¹å¤±è´¥æˆ–è€…å¤§éƒ¨åˆ†èŠ‚ç‚¹æ— æ³•é€šä¿¡çš„æƒ…å†µä¸‹é›†ç¾¤ä»ç„¶å¯ç”¨ï¼Œæ‰€ä»¥é›†ç¾¤ä½¿ç”¨äº†ä¸»ä»å¤åˆ¶æ¨¡å‹,æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæœ‰N-1ä¸ªå¤åˆ¶å“.</p>
<p>20ã€Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>Rediså¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œè¿™æ„å‘³è¿™åœ¨å®é™…ä¸­é›†ç¾¤åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹å¯èƒ½ä¼šä¸¢å¤±å†™æ“ä½œã€‚</p>
<p>21ã€Redisé›†ç¾¤ä¹‹é—´æ˜¯å¦‚ä½•å¤åˆ¶çš„ï¼Ÿ</p>
<p>å¼‚æ­¥å¤åˆ¶</p>
<p>22ã€Redisé›†ç¾¤æœ€å¤§èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>16384ä¸ªã€‚</p>
<p>23ã€Redisé›†ç¾¤å¦‚ä½•é€‰æ‹©æ•°æ®åº“ï¼Ÿ</p>
<p>Redisé›†ç¾¤ç›®å‰æ— æ³•åšæ•°æ®åº“é€‰æ‹©ï¼Œé»˜è®¤åœ¨0æ•°æ®åº“ã€‚</p>
<p>24ã€æ€ä¹ˆæµ‹è¯•Redisçš„è¿é€šæ€§ï¼Ÿ</p>
<p>ping</p>
<p>25ã€Redisä¸­çš„ç®¡é“æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>
<p>ä¸€æ¬¡è¯·æ±‚&#x2F;å“åº”æœåŠ¡å™¨èƒ½å®ç°å¤„ç†æ–°çš„è¯·æ±‚å³ä½¿æ—§çš„è¯·æ±‚è¿˜æœªè¢«å“åº”ã€‚è¿™æ ·å°±å¯ä»¥å°†å¤šä¸ªå‘½ä»¤å‘é€åˆ°æœåŠ¡å™¨ï¼Œè€Œä¸ç”¨ç­‰å¾…å›å¤ï¼Œæœ€ååœ¨ä¸€ä¸ªæ­¥éª¤ä¸­è¯»å–è¯¥ç­”å¤ã€‚</p>
<p>è¿™å°±æ˜¯ç®¡é“ï¼ˆpipeliningï¼‰ï¼Œæ˜¯ä¸€ç§å‡ åå¹´æ¥å¹¿æ³›ä½¿ç”¨çš„æŠ€æœ¯ã€‚ä¾‹å¦‚è®¸å¤šPOP3åè®®å·²ç»å®ç°æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œå¤§å¤§åŠ å¿«äº†ä»æœåŠ¡å™¨ä¸‹è½½æ–°é‚®ä»¶çš„è¿‡ç¨‹ã€‚</p>
<p>26ã€æ€ä¹ˆç†è§£Redisäº‹åŠ¡ï¼Ÿ</p>
<p>äº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</p>
<p>äº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼šäº‹åŠ¡ä¸­çš„å‘½ä»¤è¦ä¹ˆå…¨éƒ¨è¢«æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨éƒ½ä¸æ‰§è¡Œã€‚</p>
<p>27ã€Redisäº‹åŠ¡ç›¸å…³çš„å‘½ä»¤æœ‰å“ªå‡ ä¸ªï¼Ÿ</p>
<p>MULTIã€EXECã€DISCARDã€WATCH</p>
<p>28ã€Redis keyçš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®ï¼Ÿ</p>
<p>EXPIREå’ŒPERSISTå‘½ä»¤ã€‚</p>
<p>29ã€Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ</p>
<p>å°½å¯èƒ½ä½¿ç”¨æ•£åˆ—è¡¨ï¼ˆhashesï¼‰ï¼Œæ•£åˆ—è¡¨ï¼ˆæ˜¯è¯´æ•£åˆ—è¡¨é‡Œé¢å­˜å‚¨çš„æ•°å°‘ï¼‰ä½¿ç”¨çš„å†…å­˜éå¸¸å°ï¼Œæ‰€ä»¥ä½ åº”è¯¥å°½å¯èƒ½çš„å°†ä½ çš„æ•°æ®æ¨¡å‹æŠ½è±¡åˆ°ä¸€ä¸ªæ•£åˆ—è¡¨é‡Œé¢ã€‚æ¯”å¦‚ä½ çš„webç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ï¼Œä¸è¦ä¸ºè¿™ä¸ªç”¨æˆ·çš„åç§°ï¼Œå§“æ°ï¼Œé‚®ç®±ï¼Œå¯†ç è®¾ç½®å•ç‹¬çš„key,è€Œæ˜¯åº”è¯¥æŠŠè¿™ä¸ªç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯å­˜å‚¨åˆ°ä¸€å¼ æ•£åˆ—è¡¨é‡Œé¢.</p>
<p>30ã€Rediså›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</p>
<p>ä¸€ä¸ªå®¢æˆ·ç«¯è¿è¡Œäº†æ–°çš„å‘½ä»¤ï¼Œæ·»åŠ äº†æ–°çš„æ•°æ®ã€‚<br>Rediæ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœå¤§äºmaxmemoryçš„é™åˆ¶, åˆ™æ ¹æ®è®¾å®šå¥½çš„ç­–ç•¥è¿›è¡Œå›æ”¶ã€‚<br>ä¸€ä¸ªæ–°çš„å‘½ä»¤è¢«æ‰§è¡Œï¼Œç­‰ç­‰ã€‚<br>æ‰€ä»¥æˆ‘ä»¬ä¸æ–­åœ°ç©¿è¶Šå†…å­˜é™åˆ¶çš„è¾¹ç•Œï¼Œé€šè¿‡ä¸æ–­è¾¾åˆ°è¾¹ç•Œç„¶åä¸æ–­åœ°å›æ”¶å›åˆ°è¾¹ç•Œä»¥ä¸‹ã€‚<br>å¦‚æœä¸€ä¸ªå‘½ä»¤çš„ç»“æœå¯¼è‡´å¤§é‡å†…å­˜è¢«ä½¿ç”¨ï¼ˆä¾‹å¦‚å¾ˆå¤§çš„é›†åˆçš„äº¤é›†ä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„é”®ï¼‰ï¼Œä¸ç”¨å¤šä¹…å†…å­˜é™åˆ¶å°±ä¼šè¢«è¿™ä¸ªå†…å­˜ä½¿ç”¨é‡è¶…è¶Šã€‚</p>
<p>31ã€Rediså›æ”¶ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•ï¼Ÿ</p>
<p>LRUç®—æ³•</p>
<p>32ã€Rediså¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥ï¼Ÿ</p>
<p>Redis2.6å¼€å§‹redis-cliæ”¯æŒä¸€ç§æ–°çš„è¢«ç§°ä¹‹ä¸ºpipe modeçš„æ–°æ¨¡å¼ç”¨äºæ‰§è¡Œå¤§é‡æ•°æ®æ’å…¥å·¥ä½œã€‚</p>
<p>33ã€ä¸ºä»€ä¹ˆè¦åšRedisåˆ†åŒºï¼Ÿ</p>
<p>åˆ†åŒºå¯ä»¥è®©Redisç®¡ç†æ›´å¤§çš„å†…å­˜ï¼ŒRediså°†å¯ä»¥ä½¿ç”¨æ‰€æœ‰æœºå™¨çš„å†…å­˜ã€‚å¦‚æœæ²¡æœ‰åˆ†åŒºï¼Œä½ æœ€å¤šåªèƒ½ä½¿ç”¨ä¸€å°æœºå™¨çš„å†…å­˜ã€‚åˆ†åŒºä½¿Redisçš„è®¡ç®—èƒ½åŠ›é€šè¿‡ç®€å•åœ°å¢åŠ è®¡ç®—æœºå¾—åˆ°æˆå€æå‡,Redisçš„ç½‘ç»œå¸¦å®½ä¹Ÿä¼šéšç€è®¡ç®—æœºå’Œç½‘å¡çš„å¢åŠ è€Œæˆå€å¢é•¿ã€‚</p>
<p>34ã€ä½ çŸ¥é“æœ‰å“ªäº›Redisåˆ†åŒºå®ç°æ–¹æ¡ˆï¼Ÿ</p>
<p>å®¢æˆ·ç«¯åˆ†åŒºå°±æ˜¯åœ¨å®¢æˆ·ç«¯å°±å·²ç»å†³å®šæ•°æ®ä¼šè¢«å­˜å‚¨åˆ°å“ªä¸ªredisèŠ‚ç‚¹æˆ–è€…ä»å“ªä¸ªredisèŠ‚ç‚¹è¯»å–ã€‚å¤§å¤šæ•°å®¢æˆ·ç«¯å·²ç»å®ç°äº†å®¢æˆ·ç«¯åˆ†åŒºã€‚</p>
<p>ä»£ç†åˆ†åŒº æ„å‘³ç€å®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€ç»™ä»£ç†ï¼Œç„¶åä»£ç†å†³å®šå»å“ªä¸ªèŠ‚ç‚¹å†™æ•°æ®æˆ–è€…è¯»æ•°æ®ã€‚ä»£ç†æ ¹æ®åˆ†åŒºè§„åˆ™å†³å®šè¯·æ±‚å“ªäº›Rediså®ä¾‹ï¼Œç„¶åæ ¹æ®Redisçš„å“åº”ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚rediså’Œmemcachedçš„ä¸€ç§ä»£ç†å®ç°å°±æ˜¯Twemproxy</p>
<p>æŸ¥è¯¢è·¯ç”±(Query routing) çš„æ„æ€æ˜¯å®¢æˆ·ç«¯éšæœºåœ°è¯·æ±‚ä»»æ„ä¸€ä¸ªrediså®ä¾‹ï¼Œç„¶åç”±Rediså°†è¯·æ±‚è½¬å‘ç»™æ­£ç¡®çš„RedisèŠ‚ç‚¹ã€‚Redis Clusterå®ç°äº†ä¸€ç§æ··åˆå½¢å¼çš„æŸ¥è¯¢è·¯ç”±ï¼Œä½†å¹¶ä¸æ˜¯ç›´æ¥å°†è¯·æ±‚ä»ä¸€ä¸ªredisèŠ‚ç‚¹è½¬å‘åˆ°å¦ä¸€ä¸ªredisèŠ‚ç‚¹ï¼Œè€Œæ˜¯åœ¨å®¢æˆ·ç«¯çš„å¸®åŠ©ä¸‹ç›´æ¥redirectedåˆ°æ­£ç¡®çš„redisèŠ‚ç‚¹ã€‚</p>
<p>35ã€Redisåˆ†åŒºæœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ</p>
<p>æ¶‰åŠå¤šä¸ªkeyçš„æ“ä½œé€šå¸¸ä¸ä¼šè¢«æ”¯æŒã€‚ä¾‹å¦‚ä½ ä¸èƒ½å¯¹ä¸¤ä¸ªé›†åˆæ±‚äº¤é›†ï¼Œå› ä¸ºä»–ä»¬å¯èƒ½è¢«å­˜å‚¨åˆ°ä¸åŒçš„Rediså®ä¾‹ï¼ˆå®é™…ä¸Šè¿™ç§æƒ…å†µä¹Ÿæœ‰åŠæ³•ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨äº¤é›†æŒ‡ä»¤ï¼‰ã€‚<br>åŒæ—¶æ“ä½œå¤šä¸ªkey,åˆ™ä¸èƒ½ä½¿ç”¨Redisäº‹åŠ¡.<br>åˆ†åŒºä½¿ç”¨çš„ç²’åº¦æ˜¯keyï¼Œä¸èƒ½ä½¿ç”¨ä¸€ä¸ªéå¸¸é•¿çš„æ’åºkeyå­˜å‚¨ä¸€ä¸ªæ•°æ®é›†ï¼ˆThe partitioning granularity is the key, so it is not possible to shard a dataset with a single huge key like a very big sorted setï¼‰.<br>å½“ä½¿ç”¨åˆ†åŒºçš„æ—¶å€™ï¼Œæ•°æ®å¤„ç†ä¼šéå¸¸å¤æ‚ï¼Œä¾‹å¦‚ä¸ºäº†å¤‡ä»½ä½ å¿…é¡»ä»ä¸åŒçš„Rediså®ä¾‹å’Œä¸»æœºåŒæ—¶æ”¶é›†RDB &#x2F; AOFæ–‡ä»¶ã€‚<br>åˆ†åŒºæ—¶åŠ¨æ€æ‰©å®¹æˆ–ç¼©å®¹å¯èƒ½éå¸¸å¤æ‚ã€‚Redisé›†ç¾¤åœ¨è¿è¡Œæ—¶å¢åŠ æˆ–è€…åˆ é™¤RedisèŠ‚ç‚¹ï¼Œèƒ½åšåˆ°æœ€å¤§ç¨‹åº¦å¯¹ç”¨æˆ·é€æ˜åœ°æ•°æ®å†å¹³è¡¡ï¼Œä½†å…¶ä»–ä¸€äº›å®¢æˆ·ç«¯åˆ†åŒºæˆ–è€…ä»£ç†åˆ†åŒºæ–¹æ³•åˆ™ä¸æ”¯æŒè¿™ç§ç‰¹æ€§ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ç§é¢„åˆ†ç‰‡çš„æŠ€æœ¯ä¹Ÿå¯ä»¥è¾ƒå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br>36ã€RedisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹ï¼Ÿ</p>
<p>å¦‚æœRedisè¢«å½“åšç¼“å­˜ä½¿ç”¨ï¼Œä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œå®ç°åŠ¨æ€æ‰©å®¹ç¼©å®¹ã€‚<br>å¦‚æœRedisè¢«å½“åšä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨ä½¿ç”¨ï¼Œå¿…é¡»ä½¿ç”¨å›ºå®šçš„keys-to-nodesæ˜ å°„å…³ç³»ï¼ŒèŠ‚ç‚¹çš„æ•°é‡ä¸€æ—¦ç¡®å®šä¸èƒ½å˜åŒ–ã€‚å¦åˆ™çš„è¯(å³RedisèŠ‚ç‚¹éœ€è¦åŠ¨æ€å˜åŒ–çš„æƒ…å†µï¼‰ï¼Œå¿…é¡»ä½¿ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œæ•°æ®å†å¹³è¡¡çš„ä¸€å¥—ç³»ç»Ÿï¼Œè€Œå½“å‰åªæœ‰Redisé›†ç¾¤å¯ä»¥åšåˆ°è¿™æ ·ã€‚<br>37ã€åˆ†å¸ƒå¼Redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>æ—¢ç„¶Redisæ˜¯å¦‚æ­¤çš„è½»é‡ï¼ˆå•å®ä¾‹åªä½¿ç”¨1Må†…å­˜ï¼‰,ä¸ºé˜²æ­¢ä»¥åçš„æ‰©å®¹ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯ä¸€å¼€å§‹å°±å¯åŠ¨è¾ƒå¤šå®ä¾‹ã€‚å³ä¾¿ä½ åªæœ‰ä¸€å°æœåŠ¡å™¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¸€å¼€å§‹å°±è®©Redisä»¥åˆ†å¸ƒå¼çš„æ–¹å¼è¿è¡Œï¼Œä½¿ç”¨åˆ†åŒºï¼Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ªå®ä¾‹ã€‚</p>
<p>ä¸€å¼€å§‹å°±å¤šè®¾ç½®å‡ ä¸ªRediså®ä¾‹ï¼Œä¾‹å¦‚32æˆ–è€…64ä¸ªå®ä¾‹ï¼Œå¯¹å¤§å¤šæ•°ç”¨æˆ·æ¥è¯´è¿™æ“ä½œèµ·æ¥å¯èƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯ä»é•¿ä¹…æ¥çœ‹åšè¿™ç‚¹ç‰ºç‰²æ˜¯å€¼å¾—çš„ã€‚</p>
<p>è¿™æ ·çš„è¯ï¼Œå½“ä½ çš„æ•°æ®ä¸æ–­å¢é•¿ï¼Œéœ€è¦æ›´å¤šçš„RedisæœåŠ¡å™¨æ—¶ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯ä»…ä»…å°†Rediså®ä¾‹ä»ä¸€å°æœåŠ¡è¿ç§»åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨è€Œå·²ï¼ˆè€Œä¸ç”¨è€ƒè™‘é‡æ–°åˆ†åŒºçš„é—®é¢˜ï¼‰ã€‚ä¸€æ—¦ä½ æ·»åŠ äº†å¦ä¸€å°æœåŠ¡å™¨ï¼Œä½ éœ€è¦å°†ä½ ä¸€åŠçš„Rediså®ä¾‹ä»ç¬¬ä¸€å°æœºå™¨è¿ç§»åˆ°ç¬¬äºŒå°æœºå™¨ã€‚</p>
<p>38ã€Twemproxyæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>Twemproxyæ˜¯Twitterç»´æŠ¤çš„ï¼ˆç¼“å­˜ï¼‰ä»£ç†ç³»ç»Ÿï¼Œä»£ç†Memcachedçš„ASCIIåè®®å’ŒRedisåè®®ã€‚å®ƒæ˜¯å•çº¿ç¨‹ç¨‹åºï¼Œä½¿ç”¨cè¯­è¨€ç¼–å†™ï¼Œè¿è¡Œèµ·æ¥éå¸¸å¿«ã€‚å®ƒæ˜¯é‡‡ç”¨Apache 2.0 licenseçš„å¼€æºè½¯ä»¶ã€‚ Twemproxyæ”¯æŒè‡ªåŠ¨åˆ†åŒºï¼Œå¦‚æœå…¶ä»£ç†çš„å…¶ä¸­ä¸€ä¸ªRedisèŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨å°†è¯¥èŠ‚ç‚¹æ’é™¤ï¼ˆè¿™å°†æ”¹å˜åŸæ¥çš„keys-instancesçš„æ˜ å°„å…³ç³»ï¼Œæ‰€ä»¥ä½ åº”è¯¥ä»…åœ¨æŠŠRediså½“ç¼“å­˜æ—¶ä½¿ç”¨Twemproxy)ã€‚ Twemproxyæœ¬èº«ä¸å­˜åœ¨å•ç‚¹é—®é¢˜ï¼Œå› ä¸ºä½ å¯ä»¥å¯åŠ¨å¤šä¸ªTwemproxyå®ä¾‹ï¼Œç„¶åè®©ä½ çš„å®¢æˆ·ç«¯å»è¿æ¥ä»»æ„ä¸€ä¸ªTwemproxyå®ä¾‹ã€‚ Twemproxyæ˜¯Rediså®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ä¸€ä¸ªä¸­é—´å±‚ï¼Œç”±å®ƒæ¥å¤„ç†åˆ†åŒºåŠŸèƒ½åº”è¯¥ä¸ç®—å¤æ‚ï¼Œå¹¶ä¸”åº”è¯¥ç®—æ¯”è¾ƒå¯é çš„ã€‚</p>
<p>39ã€æ”¯æŒä¸€è‡´æ€§å“ˆå¸Œçš„å®¢æˆ·ç«¯æœ‰å“ªäº›ï¼Ÿ</p>
<p>Redis-rbã€Predisç­‰ã€‚</p>
<p>40ã€Redisä¸å…¶ä»–key-valueå­˜å‚¨æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p>
<p>Redisæœ‰ç€æ›´ä¸ºå¤æ‚çš„æ•°æ®ç»“æ„å¹¶ä¸”æä¾›å¯¹ä»–ä»¬çš„åŸå­æ€§æ“ä½œï¼Œè¿™æ˜¯ä¸€ä¸ªä¸åŒäºå…¶ä»–æ•°æ®åº“çš„è¿›åŒ–è·¯å¾„ã€‚Redisçš„æ•°æ®ç±»å‹éƒ½æ˜¯åŸºäºåŸºæœ¬æ•°æ®ç»“æ„çš„åŒæ—¶å¯¹ç¨‹åºå‘˜é€æ˜ï¼Œæ— éœ€è¿›è¡Œé¢å¤–çš„æŠ½è±¡ã€‚<br>Redisè¿è¡Œåœ¨å†…å­˜ä¸­ä½†æ˜¯å¯ä»¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥åœ¨å¯¹ä¸åŒæ•°æ®é›†è¿›è¡Œé«˜é€Ÿè¯»å†™æ—¶éœ€è¦æƒè¡¡å†…å­˜ï¼Œåº”ä¸ºæ•°æ®é‡ä¸èƒ½å¤§äºç¡¬ä»¶å†…å­˜ã€‚åœ¨å†…å­˜æ•°æ®åº“æ–¹é¢çš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œ ç›¸æ¯”åœ¨ç£ç›˜ä¸Šç›¸åŒçš„å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œåœ¨å†…å­˜ä¸­æ“ä½œèµ·æ¥éå¸¸ç®€å•ï¼Œè¿™æ ·Rediså¯ä»¥åšå¾ˆå¤šå†…éƒ¨å¤æ‚æ€§å¾ˆå¼ºçš„äº‹æƒ…ã€‚ åŒæ—¶ï¼Œåœ¨ç£ç›˜æ ¼å¼æ–¹é¢ä»–ä»¬æ˜¯ç´§å‡‘çš„ä»¥è¿½åŠ çš„æ–¹å¼äº§ç”Ÿçš„ï¼Œå› ä¸ºä»–ä»¬å¹¶ä¸éœ€è¦è¿›è¡Œéšæœºè®¿é—®ã€‚<br>41ã€Redisçš„å†…å­˜å ç”¨æƒ…å†µæ€ä¹ˆæ ·ï¼Ÿ</p>
<p>ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼š 100ä¸‡ä¸ªé”®å€¼å¯¹ï¼ˆé”®æ˜¯0åˆ°999999å€¼æ˜¯å­—ç¬¦ä¸²â€œhello worldâ€ï¼‰åœ¨æˆ‘çš„32ä½çš„Macç¬”è®°æœ¬ä¸Š ç”¨äº†100MBã€‚åŒæ ·çš„æ•°æ®æ”¾åˆ°ä¸€ä¸ªkeyé‡Œåªéœ€è¦16MBï¼Œ è¿™æ˜¯å› ä¸ºé”®å€¼æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¼€é”€ã€‚ åœ¨Memcachedä¸Šæ‰§è¡Œä¹Ÿæ˜¯ç±»ä¼¼çš„ç»“æœï¼Œä½†æ˜¯ç›¸å¯¹Redisçš„å¼€é”€è¦å°ä¸€ç‚¹ç‚¹ï¼Œå› ä¸ºRedisä¼šè®°å½•ç±»å‹ä¿¡æ¯å¼•ç”¨è®¡æ•°ç­‰ç­‰ã€‚</p>
<p>å½“ç„¶ï¼Œå¤§é”®å€¼å¯¹æ—¶ä¸¤è€…çš„æ¯”ä¾‹è¦å¥½å¾ˆå¤šã€‚</p>
<p>64ä½çš„ç³»ç»Ÿæ¯”32ä½çš„éœ€è¦æ›´å¤šçš„å†…å­˜å¼€é”€ï¼Œå°¤å…¶æ˜¯é”®å€¼å¯¹éƒ½è¾ƒå°æ—¶ï¼Œè¿™æ˜¯å› ä¸º64ä½çš„ç³»ç»Ÿé‡ŒæŒ‡é’ˆå ç”¨äº†8ä¸ªå­—èŠ‚ã€‚ ä½†æ˜¯ï¼Œå½“ç„¶ï¼Œ64ä½ç³»ç»Ÿæ”¯æŒæ›´å¤§çš„å†…å­˜ï¼Œæ‰€ä»¥ä¸ºäº†è¿è¡Œå¤§å‹çš„RedisæœåŠ¡å™¨æˆ–å¤šæˆ–å°‘çš„éœ€è¦ä½¿ç”¨64ä½çš„ç³»ç»Ÿã€‚</p>
<p>42ã€éƒ½æœ‰å“ªäº›åŠæ³•å¯ä»¥é™ä½Redisçš„å†…å­˜ä½¿ç”¨æƒ…å†µå‘¢ï¼Ÿ</p>
<p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯32ä½çš„Rediså®ä¾‹ï¼Œå¯ä»¥å¥½å¥½åˆ©ç”¨Hash,list,sorted set,setç­‰é›†åˆç±»å‹æ•°æ®ï¼Œå› ä¸ºé€šå¸¸æƒ…å†µä¸‹å¾ˆå¤šå°çš„Key-Valueå¯ä»¥ç”¨æ›´ç´§å‡‘çš„æ–¹å¼å­˜æ”¾åˆ°ä¸€èµ·ã€‚</p>
<p>43ã€æŸ¥çœ‹Redisä½¿ç”¨æƒ…å†µåŠçŠ¶æ€ä¿¡æ¯ç”¨ä»€ä¹ˆå‘½ä»¤ï¼Ÿ</p>
<p>info</p>
<p>44ã€Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<p>å¦‚æœè¾¾åˆ°è®¾ç½®çš„ä¸Šé™ï¼ŒRedisçš„å†™å‘½ä»¤ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼ˆä½†æ˜¯è¯»å‘½ä»¤è¿˜å¯ä»¥æ­£å¸¸è¿”å›ã€‚ï¼‰æˆ–è€…ä½ å¯ä»¥å°†Rediså½“ç¼“å­˜æ¥ä½¿ç”¨é…ç½®æ·˜æ±°æœºåˆ¶ï¼Œå½“Redisè¾¾åˆ°å†…å­˜ä¸Šé™æ—¶ä¼šå†²åˆ·æ‰æ—§çš„å†…å®¹ã€‚</p>
<p>45ã€Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚ä½•æé«˜å¤šæ ¸CPUçš„åˆ©ç”¨ç‡ï¼Ÿ</p>
<p>å¯ä»¥åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨éƒ¨ç½²å¤šä¸ªRedisçš„å®ä¾‹ï¼Œå¹¶æŠŠä»–ä»¬å½“ä½œä¸åŒçš„æœåŠ¡å™¨æ¥ä½¿ç”¨ï¼Œåœ¨æŸäº›æ—¶å€™ï¼Œæ— è®ºå¦‚ä½•ä¸€ä¸ªæœåŠ¡å™¨æ˜¯ä¸å¤Ÿçš„ï¼Œ æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å¤šä¸ªCPUï¼Œä½ å¯ä»¥è€ƒè™‘ä¸€ä¸‹åˆ†ç‰‡ï¼ˆshardï¼‰ã€‚</p>
<p>46ã€ä¸€ä¸ªRediså®ä¾‹æœ€å¤šèƒ½å­˜æ”¾å¤šå°‘çš„keysï¼ŸListã€Setã€Sorted Setä»–ä»¬æœ€å¤šèƒ½å­˜æ”¾å¤šå°‘å…ƒç´ ï¼Ÿ</p>
<p>ç†è®ºä¸ŠRediså¯ä»¥å¤„ç†å¤šè¾¾232çš„keysï¼Œå¹¶ä¸”åœ¨å®é™…ä¸­è¿›è¡Œäº†æµ‹è¯•ï¼Œæ¯ä¸ªå®ä¾‹è‡³å°‘å­˜æ”¾äº†2äº¿5åƒä¸‡çš„keysã€‚æˆ‘ä»¬æ­£åœ¨æµ‹è¯•ä¸€äº›è¾ƒå¤§çš„å€¼ã€‚</p>
<p>ä»»ä½•listã€setã€å’Œsorted setéƒ½å¯ä»¥æ”¾232ä¸ªå…ƒç´ ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼ŒRedisçš„å­˜å‚¨æé™æ˜¯ç³»ç»Ÿä¸­çš„å¯ç”¨å†…å­˜å€¼ã€‚</p>
<p>47ã€Rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ</p>
<p>(1) Masteræœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼Œå¦‚RDBå†…å­˜å¿«ç…§å’ŒAOFæ—¥å¿—æ–‡ä»¶</p>
<p>(2) å¦‚æœæ•°æ®æ¯”è¾ƒé‡è¦ï¼ŒæŸä¸ªSlaveå¼€å¯AOFå¤‡ä»½æ•°æ®ï¼Œç­–ç•¥è®¾ç½®ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡</p>
<p>(3) ä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒMasterå’ŒSlaveæœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…</p>
<p>(4) å°½é‡é¿å…åœ¨å‹åŠ›å¾ˆå¤§çš„ä¸»åº“ä¸Šå¢åŠ ä»åº“</p>
<p>(5) ä¸»ä»å¤åˆ¶ä¸è¦ç”¨å›¾çŠ¶ç»“æ„ï¼Œç”¨å•å‘é“¾è¡¨ç»“æ„æ›´ä¸ºç¨³å®šï¼Œå³ï¼šMaster &lt;- Slave1 &lt;- Slave2 &lt;- Slave3â€¦</p>
<p>è¿™æ ·çš„ç»“æ„æ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå®ç°Slaveå¯¹Masterçš„æ›¿æ¢ã€‚å¦‚æœMasteræŒ‚äº†ï¼Œå¯ä»¥ç«‹åˆ»å¯ç”¨Slave1åšMasterï¼Œå…¶ä»–ä¸å˜ã€‚</p>
<p>48ã€Redisæä¾›äº†å“ªå‡ ç§æŒä¹…åŒ–æ–¹å¼ï¼Ÿ</p>
<p>RDBæŒä¹…åŒ–æ–¹å¼èƒ½å¤Ÿåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”èƒ½å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨.<br>AOFæŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨å†™çš„æ“ä½œ,å½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®,AOFå‘½ä»¤ä»¥redisåè®®è¿½åŠ ä¿å­˜æ¯æ¬¡å†™çš„æ“ä½œåˆ°æ–‡ä»¶æœ«å°¾.Redisè¿˜èƒ½å¯¹AOFæ–‡ä»¶è¿›è¡Œåå°é‡å†™,ä½¿å¾—AOFæ–‡ä»¶çš„ä½“ç§¯ä¸è‡³äºè¿‡å¤§.<br>å¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨,ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼.<br>ä½ ä¹Ÿå¯ä»¥åŒæ—¶å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼, åœ¨è¿™ç§æƒ…å†µä¸‹, å½“redisé‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥AOFæ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®,å› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´.<br>æœ€é‡è¦çš„äº‹æƒ…æ˜¯äº†è§£RDBå’ŒAOFæŒä¹…åŒ–æ–¹å¼çš„ä¸åŒ,è®©æˆ‘ä»¬ä»¥RDBæŒä¹…åŒ–æ–¹å¼å¼€å§‹ã€‚<br>49ã€å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–æ–¹å¼ï¼Ÿ</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œ å¦‚æœæƒ³è¾¾åˆ°è¶³ä»¥åª²ç¾PostgreSQLçš„æ•°æ®å®‰å…¨æ€§ï¼Œ ä½ åº”è¯¥åŒæ—¶ä½¿ç”¨ä¸¤ç§æŒä¹…åŒ–åŠŸèƒ½ã€‚å¦‚æœä½ éå¸¸å…³å¿ƒä½ çš„æ•°æ®ï¼Œ ä½†ä»ç„¶å¯ä»¥æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆä½ å¯ä»¥åªä½¿ç”¨RDBæŒä¹…åŒ–ã€‚</p>
<p>æœ‰å¾ˆå¤šç”¨æˆ·éƒ½åªä½¿ç”¨AOFæŒä¹…åŒ–ï¼Œä½†å¹¶ä¸æ¨èè¿™ç§æ–¹å¼ï¼šå› ä¸ºå®šæ—¶ç”ŸæˆRDBå¿«ç…§ï¼ˆsnapshotï¼‰éå¸¸ä¾¿äºè¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œ å¹¶ä¸” RDB æ¢å¤æ•°æ®é›†çš„é€Ÿåº¦ä¹Ÿè¦æ¯”AOFæ¢å¤çš„é€Ÿåº¦è¦å¿«ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œ ä½¿ç”¨RDBè¿˜å¯ä»¥é¿å…ä¹‹å‰æåˆ°çš„AOFç¨‹åºçš„bugã€‚</p>
<p>50ã€ä¿®æ”¹é…ç½®ä¸é‡å¯Redisä¼šå®æ—¶ç”Ÿæ•ˆå—ï¼Ÿ</p>
<p>é’ˆå¯¹è¿è¡Œå®ä¾‹ï¼Œæœ‰è®¸å¤šé…ç½®é€‰é¡¹å¯ä»¥é€šè¿‡ CONFIG SET å‘½ä»¤è¿›è¡Œä¿®æ”¹ï¼Œè€Œæ— éœ€æ‰§è¡Œä»»ä½•å½¢å¼çš„é‡å¯ã€‚ ä» Redis 2.2 å¼€å§‹ï¼Œå¯ä»¥ä» AOF åˆ‡æ¢åˆ° RDB çš„å¿«ç…§æŒä¹…æ€§æˆ–å…¶ä»–æ–¹å¼è€Œä¸éœ€è¦é‡å¯ Redisã€‚æ£€ç´¢ â€˜CONFIG GET *â€™ å‘½ä»¤è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<p>ä½†å¶å°”é‡æ–°å¯åŠ¨æ˜¯å¿…é¡»çš„ï¼Œå¦‚ä¸ºå‡çº§ Redis ç¨‹åºåˆ°æ–°çš„ç‰ˆæœ¬ï¼Œæˆ–è€…å½“ä½ éœ€è¦ä¿®æ”¹æŸäº›ç›®å‰ CONFIG å‘½ä»¤è¿˜ä¸æ”¯æŒçš„é…ç½®å‚æ•°çš„æ—¶å€™ã€‚</p>
<p>è½¬è½½äºï¼š<a target="_blank" rel="noopener" href="https://cloudpai.gitee.io/2018/04/18/2018-04-18-3/">https://cloudpai.gitee.io/2018/04/18/2018-04-18-3/</a></p>

          
        
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>

  <hr/>

    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"></a>
  </nav>



          </div>
          


          

        </div>
        
          
    
  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

  

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="sidebar-sticky sticky">
            <div itemscope="" itemtype="http://schema.org/Person">
              <div class="author__avatar">
                
                  <img itemprop="image"
                    src="/images/avatar.jpg"
                    alt="" /> 
                
              </div>
              <div class="author__content">
                <h3 class="author__name" itemprop="name"></h3>
                <p class="author__bio" itemprop="description"></p>
              </div>
              
                <div class="author__urls-wrapper">
                  <button class="btn btn--inverse">Follow</button>
                  <ul class="author__urls social-icons">
                    
                      <li>
                        <a href="https://github.com/ruiyeclub" target="_blank" title="GitHub">
                            
                              <i class="fa fa-fw fa-github"></i>&nbsp;&nbsp;GitHub</a>
                      </li>
                    
                      <li>
                        <a href="https://github.com/ruiyeclub/ray4j.top" target="_blank" title="Ray4j.top">
                            
                              <i class="fa fa-fw fa-link"></i>&nbsp;&nbsp;Ray4j.top</a>
                      </li>
                    
                      <li>
                        <a href="https://github.com/ruiyeclub/SpringBoot-Hello" target="_blank" title="Springboot-Hello">
                            
                              <i class="fa fa-fw fa-cloud"></i>&nbsp;&nbsp;Springboot-Hello</a>
                      </li>
                    

                    
                      <li class="menu-item menu-item-search">
                        
                          <a href="javascript:;" class="popup-trigger">
                          <i class="fa fa-fw fa-search"></i>&nbsp;&nbsp;
                        
                          
                          
                          Search
                        </a>
                      </li>
                    

                    
                      <div class="site-search">
                        
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



                      </div>
                    

                  </ul>
                </div>
              
            </div>
          </div>
        </div>
      </section>



      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" style="display: inline-block">&copy; 2022 &mdash; <span itemprop="copyrightYear">2024</span>
  <span class="author" itemprop="copyrightHolder">Cr.</span>

  
  &nbsp;&nbsp; | &nbsp;&nbsp;
</div>

        
<div class="busuanzi-count" style="display: inline-block">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      UV
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      PV
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    <div class="back-to-top">
      <span style="font-family:'Source Sans Pro','Helvetica Neue',Arial,sans-serif;font-size:1.2em;font-weight:600">TOP</span>
    </div>

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  


  <script type="text/javascript" src="/js/src/mo.min.js"></script>
  <script>$(function(){$("a").not(".nav-link,.cloud-tie-join-count,.ignore-href,.jstree-anchor").addClass("animsition-link")});var burst1=new mojs.Burst({left:0,top:0,radius:{5:40},children:{shape:"circle",fill:["red","cyan","orange"],fillOpacity:.8,radiusX:3.5,radiusY:3.5}});document.addEventListener("click",function(a){null==a.target.href&&"footer"!=a.target.className&&"copyright"!=a.target.className&&"author__urls social-icons"!=a.target.className&&"author__avatar"!=a.target.className&&"sidebar sidebar-active"!=a.target.className&&burst1.tune({x:a.pageX,y:a.pageY}).generate().replay()})</script>
  <div data-name="mojs-shape"></div>
  
</body>
</html>
